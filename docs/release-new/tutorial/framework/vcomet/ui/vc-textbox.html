<template>

  <div class="textboxGroup unselectable">
    <label class="textboxLabel"></label>
    <input class="textbox">
    <span class="inputBar"></span>
  </div>

</template>

<script>
  vcomet.element("vc-textbox", {
    themed: true,
    properties: {
      /*
        @property {string} type 
        @description Textbox type
        Values can be: text or password
        Default: text
      */
      type: {
        value: "text",
        reflect: true
      },
      /*
        @property {string} name 
        @description Textbox name
      */
      name: {
        value: "",
        reflect: true
      },
      /*
        @property {string} value 
        @description Textbox value
      */
      value: {
        value: "",
        reflect: true
      },
      /*
        @property {string} placeholder 
        @description Textbox placeholder
      */
      placeholder: {
        value: "",
        reflect: true
      },
      /*
        @property {string} label 
        @description Textbox label
      */
      label: {
        value: "",
        reflect: true
      },
      /*
        @property {string} width 
        @description Textbox size respect to container
        Value must be number percentage
        Default: 50%
      */
      width: {
        value: "50%",
        reflect: true
      },
      /*
        @property {string} disable 
        @description Textbox desactivation
        Values can be: true or false
        Default: false
      */
      disable: {
        value: "false",
        reflect: true
      },
      /*
        @property {string} readonly 
        @description Textbox read only mode
        Values can be: true or false
        Default: false
      */
      readonly: {
        value: "false",
        reflect: true
      },
      /*
        @property {string} maxlength 
        @description Textbox maximum characters number
        Value must be int number
        Default: valueless
      */
      maxlength: {
        value: "",
        reflect: true
      },
      /*
        @property {string} counter 
        @description Textbox characters counter
        Values can be: simple, maximal or false
        Default: false
      */
      counter: {
        value: "false",
        reflect: true
      },
      /*
        @property {string} autofocus 
        @description Textbox automatically get focus when page loads
        Values can be: true or false
        Default: false
      */
      autofocus: {
        value: "false",
        reflect: true
      },
    },
    privateProperties: {
      /*
        @property (private) {string} _formelement 
        @description Set that textbox is a form element
        Value: textbox
      */
      formelement: {
        value: "textbox"
      },
      /*
        @property (private) {string} _currentvalue
        @description Current textbox value
      */
      currentvalue: {
        value: ""
      }
    },

    functions: {
      /*
        @function setValue
        @description Set new textbox value
        @param {string} newVal [new chechbox value]
      */
      setValue: function (newVal) {

        this.querySelector(".textbox").value = newVal;
        this._addValue();
        this._currentvalue = newVal;
        vcomet.triggerCallback("onChange", this);

      }
    },

    privateFunctions: {
      /*
        @function (private) _updateDisable
        @description Update disable status
        @param {string} newVal [new value of disabled]
      */
      updateDisable: function (newValue) {
        var textboxGroup = this.querySelector(".textboxGroup");
        var textbox = this.querySelector(".textbox");

        if (newValue == false || newValue == "false") {

          textbox.removeAttribute("disabled");
          textboxGroup.classList.remove("disableTextGroup");

        } else {

          textbox.setAttribute("disabled", "true");
          textboxGroup.classList.remove("readonlyTextGroup");
          textboxGroup.classList.add("disableTextGroup");

        }
      },

      /*
        @function (private) _updateReadonly
        @description Update readonly status
        @param {string} newVal [new value of readonly]
      */
      updateReadonly: function (newValue) {
        var textboxGroup = this.querySelector(".textboxGroup");
        var textbox = this.querySelector(".textbox");

        if (newValue == false || newValue == "false") {

          textbox.removeAttribute("readonly");
          textboxGroup.classList.remove("readonlyTextGroup");

        } else {

          textbox.setAttribute("disabled", "true");
          textboxGroup.classList.remove("disableTextGroup");
          textboxGroup.classList.add("readonlyTextGroup");

        }

      },

      /*
        @function (private) _addValue
        @description Add input textbox value to textbox element
        @param {string} newVal [new value of readonly]
      */
      addValue: function () {
        var textbox = this.querySelector(".textbox");

        this.value = textbox.value;

      },

      /*
        @function (private) _addTextCounter
        @description Add text characters counter
        @param {object}  textboxGroup [textbox group node]
      */
      addTextCounter: function (textboxGroup) {
        var el = this;
        var counter = document.createElement("div");
        var textbox = el.querySelector(".textbox");
        var maxLength = (el.maxlength) ? el.maxlength : 10;
        counter.classList.add("counter");
        textboxGroup.parentNode.insertBefore(counter, textboxGroup.nextSibling);

        // Sets inital value of counter
        counter.innerHTML = (el.counter == "simple") ? 0 : counter.innerHTML;
        counter.innerHTML = (el.counter == "maximal") ? 0 + "/" + maxLength : counter.innerHTML;

        // Add counter listener 
        textbox.addEventListener("input", function (e) {

          counter.innerHTML = (el.counter == "simple") ? textbox.value.length : counter.innerHTML;
          counter.innerHTML = (el.counter == "maximal") ? textbox.value.length + "/" + maxLength : counter.innerHTML;
        
        });

      }

    },

    /*
      @function onCreated
       @description Set callback 
    */
    onCreated: function () {
      vcomet.createCallback("onChange", this);
    },

    /*
      @function onRender
      @description set attributes and listeners call to functionality
    */
    onRender: function () {
      var el = this;
      var textGroup = el.querySelector(".textboxGroup");
      var textbox = el.querySelector(".textbox");
      var label = el.querySelector(".textboxLabel");
      var counter = el.querySelector(".counter");

      // On key up, update de value
      textbox.addEventListener("keydown", function () {
        el._addValue();
      }, false);

      // When the element get focus
      textbox.addEventListener("focus", function () {
        
        label.classList.add("focusLabel");
        textbox.classList.add("focusTextbox");
        (counter) ? counter.classList.add("focusCounter") : null;

      }, false);

      // When the element loses focus
      textbox.addEventListener("blur", function () {

        label.classList.remove("focusLabel");
        el._addValue();
        (counter) ? counter.classList.remove("focusCounter") : null;
        // Trigger onChange callback
        el._currentvalue = (textbox.value !== el._currentvalue) ?  textbox.value : el._currentvalue;
        (textbox.value !== el._currentvalue) ? vcomet.triggerCallback("onChange", el) : null;
      
      }, false);

      // Sets a type of input
      // Two types: text and password
      textbox.setAttribute("type", el.type);
      // Sets the name of the input
      textbox.setAttribute("name", el.name);
      // Sets a default value set by the user
      (el.value) ? textbox.setAttribute("value", el.value) : null;
      el._currentvalue = (el.value) ? el.value : el._currentvalue;
      // Sets a default placeholder set by the user
      (el.placeholder) ? textbox.setAttribute("placeholder", el.placeholder) : null;
      // Sets the label of the input
      (el.label) ? label.classList.add("displayLabel") : null;
      // Sets the width of the textbox
      el.style.width = el.width;
      // Sets a max length set by the user
      (el.maxlength) ? textbox.setAttribute("maxlength", el.maxlength) : null;
      // Add to the textbox a character counter
      (el.counter != "false") ? el._addTextCounter(textGroup) : null;
      // Gives autofocus to the textbox
      (el.autofocus == "true") ? textbox.setAttribute("autofocus", "true") : null;
      el._updateDisable(el.disable);
      el._updateReadonly(el.readonly);
      el.querySelector(".textboxLabel").innerHTML = el.label;

    },

    /*
      @function onPropertyChanged
      @description Call functionality when change property value 
    */
    onPropertyChanged: function (attrName, oldVal, newVal) {

      switch (attrName) {
        case "disable":
          this._updateDisable(newVal);
          break;
        case "readonly":
          this._updateReadonly(newVal);
          break;
        case "label":
          this.querySelector(".textboxLabel").innerHTML = newVal;
          break;
      }
    }
  });

</script>