<template>
</template>

<script>
  vcomet.element("vc-stack", "vc-stack.css", {
    dependencies: [
      "../vc-panel"
    ],
    privateProperties: {
      /*
      @property {object} _misc
      @description Object with usefull information
      */
      misc: {
        value: {},
        reflect: false
      }
    },

    privateFunctions: {
      /*
      @function setup
      @description Here we setup everything we need for the element
      */
      setup: function () {

        var el = this;
        var children = el.children;

        el._misc.panels = {};
        el._misc.indexedPanels = [];

        for (var i = 0; i < children.length; i++) {

          // Only vc-panel will be taken into account
          if (children[i].nodeName.toLowerCase() == "vc-panel") {
            el._misc.indexedPanels.push(children[i]);
            el._misc.panels[children[i].id] = children[i];
          }

        }

        // If there are panels, then we show/render the first one
        if (el._misc.indexedPanels.length > 0) {

          el._misc.indexedPanels[0].onReady(function () {
            el._misc.indexedPanels[0].classList.add("visible");
            el._misc.indexedPanels[0].render();
          })

        }

      },
      /*
      @function swaptToContainer
      @description Hides the current container and shows the requested one
      @param {object} targetContainer
      */
      swapToContainer: function (targetContainer) {
        var previousContainer = this.getCurrentContainer();
        if (targetContainer) {
          previousContainer.classList.remove("visible");
          targetContainer.classList.add("visible");
        }
        vcomet.triggerCallback("onSwapped", this, this, [previousContainer, targetContainer]);
      },
    },

    functions: {
      /*
      @function swapToContainerById
      @description Swaps to a container with the requested id
      @param {string} id
      */
      swapToContainerById: function (id) {
        this._swapToContainer(this._misc.panels[id]);
      },
      /*
      @function swapToContainerByIndex
      @description Swaps to a container with the requested index
      @param {string} index
      */
      swapToContainerByIndex: function (index) {
        this._swapToContainer(this._misc.indexedPanels[index]);
      },
      /*
      @function {object} getCurrentContainer
      @description Returns the current selected container
      */
      getCurrentContainer: function () {
        return this.querySelector('vc-container[target="stackcontainer"].visible');
      }
    },
    onCreated: function () {
      vcomet.createCallback("onSwapped", this);
    },
    onRender: function () {
      this._setup();
    }
  });

</script>