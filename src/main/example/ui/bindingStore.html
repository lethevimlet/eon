<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>VCOMET STORE BINDING</title>

    <!-- Import VimletJS  -->
    <script src="/vcomet/vcomet.js"></script>

    <script>
        vcomet.import("/vcomet/ui/vc-variable.html");
        vcomet.import("/vcomet/ui/vc-test.html");
        vcomet.import("/vcomet/data/store/vc-store.html");
    </script>

    <style>
        html,
        body {
            height: 100%;
            width: 100%;
            margin: 0;
            background-color: #2d2d2d;
            display: flex;
            justify-content: center;
        }

        .main {
            height: 70%;
            max-width: 432.5px;
            width: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            align-self: center;
            flex-direction: column;
        }

        .card {
            padding: 30px;
            background-color: #4e4e4e;
            width: 100%;
            display: flex;
            box-sizing: border-box;
            height: 350px;
        }

        .navigator {
            margin-top: 10px;
            width: 100%;
            display: flex;
            justify-content: space-between;
        }

        .changeList {
            flex-grow: 1;
            margin-top: 16px;
        }

        .languages {
            margin-bottom: 15px;
            width: 100%;
            display: flex;
            justify-content: space-between;
        }

        .btn {
            font-weight: bold;
            text-align: center;
            line-height: 40px;
            line-height: 37px;
            height: 35px;
            width: 150px;
            background: #906749;
            cursor: pointer;
            transition: .2s;
        }

        .btn:hover {
            background: #8e735f;
        }

        .listBtn {
            flex-grow: 1;
        }

        .langBtn {
            width: 100px;
        }

        .fields {
            flex-grow: 1;
            text-align: center;
            flex-basis: 0;
        }

        .field {
            margin: 10px;
        }

        .input {
            flex-grow: 1;
            text-align: center;
            flex-basis: 0;
        }

        .fields,
        .input {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .photo {
            width: 50%;
            height: 400px;
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
        }
    </style>

</head>

<body>

    <div class="main unselectable" data="{ photo: 'none' }">

        {{= data.photo}}

        <div class="photo"></div>

        <vc-store id="clientStore" url="util/binding/inter.json">
        </vc-store>

        <div class="navigator languages">

            <div class="btn langBtn" onclick="changeLang('en')">EN</div>
            <div class="btn langBtn" onclick="changeLang('es')">ES</div>
            <div class="btn langBtn" onclick="changeLang('hun')">HUN</div>
            <div class="btn langBtn" onclick="changeLang('fr')">FR</div>

        </div>
        <div class="card">

            <!-- <template id="client"> -->

            <div class="fields">

                <vc-store id="langStore" url="util/binding/interLang.json">
                </vc-store>

                <div class="field">{{= data.name}}</div>
                <div class="field">{{= data.lastname}}</div>
                <div class="field">{{= data.age}}</div>
                <div class="field">{{= data.phone}}</div>
                <div class="field">{{= data.dni}}</div>
                <div class="field">{{= data.pet_name}}</div>
                <div class="field">{{= data.pulga_name}}</div>

            </div>


            <div class="input">

                <div class="field">{{= data.name}}</div>
                <div class="field">{{= data.lastname}}</div>
                <div class="field">{{= data.age}}</div>
                <div class="field">{{= data.phone}}</div>
                <div class="field">{{= data.dni}}</div>
                <div class="field">{{= data.pet.name}}</div>
                <div class="field">{{= data.pet.pulga.name}}</div>

            </div>

            <!-- </template> -->

        </div>
        <div class="navigator">

            <div class="btn" onclick="prev()">Previous</div>
            <div class="btn" onclick="next()">Next</div>

        </div>

        <div class="navigator changeList">

            <div class="btn listBtn" onclick="changeSrc()">Change Source</div>

        </div>
    </div>


    <script>

        var clientStore = document.querySelector("#clientStore");
        var langStore = document.querySelector("#langStore");

        var clientData, langData;
        var page = 0;

        vcomet.onReady(function () {

            clientStore.type = "memory";
            langStore.type = "memory";

            clientStore.onLoaded(function (store) {

                clientStore.fetch(function () {

                    clientData = clientStore.data.asObject();

                    vcomet.data.init(document.querySelector(".main"), clientData[page], function (attrName, vcometVariable, newValue) {

                        if (attrName == "photo") {

                            var photo = document.querySelector(".photo");

                            vcometVariable.innerHTML = "";
                            photo.style.backgroundImage = "url(" + newValue + ")";

                        }

                    });

                    // LangStore.fetch is called here so that it happens when clientData has been already filled
                    langStore.fetch(function () {
                        langData = langStore.data.asObject()
                        vcomet.data.init(document.querySelector(".fields"), langData["en"]);
                    });

                });

            });

        });

        function prev() {

            var main = document.querySelector(".main");

            page = (page - 1) >= 0 ? page - 1 : 0;
            main.data = clientStore.data.asObject()[page];

        };

        function next() {

            var main = document.querySelector(".main");
            var limit = Object.keys(clientStore.data.asObject()).length - 1;

            page = (page + 1) < limit ? page + 1 : limit;
            main.data = clientStore.data.asObject()[page];

        };

        function changeSrc() {

            var main = document.querySelector(".main");
            if (clientStore.url !== "util/binding/inter2.json") {
                page = 0;
                clientStore.url = "util/binding/inter2.json";
                clientStore.fetch(function () {
                    main.data = clientStore.data.asObject()[page];
                });
            }

        };

        function changeLang(code) {

            var fields = document.querySelector(".fields");

            for (var field in langData[code]) {
                fields.data[field] = langData[code][field];
            }

        };

    </script>

    <script>

    </script>



</body>

</html>