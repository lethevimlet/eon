language: node_js
node_js:
- lts/*
cache:
  directories:
  - "${HOME}/.npm"
  - node_modules
  - eon-core/node_modules
  - eon-ui/node_modules
env:
  global:
  - secure: xtkusG9KYnXnlc6aveEds/QaijLNhrO0zMcbFb8+pXjOlOl1scfHSaxt+gfQDGRvrIPmeWcamT9QNWNGZlY1ZRsZpbEzGSh1hPPsaEGXiG1Wgz4GIV7hY3e6TsL1bWTM5R97zXNCrampJr9EeuFM/S1EXr7h0YOpVib/mmpWbwbZSPS5dha9p5jswieWA88hcb8J+rV5TmTtIqikZxnOUfBEbKZ0EhI8aZcwB4YsTBfoft6jpf88D3P/Pw2DDLLVyAxm/wLAm01IKEAG3z/QxgJri9JYxQ87X4U2puNYJnIwQbujGpdMBU47V/hYDBo5/eBwQwe1zjwThzOpSFd+9A4qx1lkETdjOVr+gTOMFJ074ox8KyIsnwkucv2+V0AKok3vDvH1O/zuxNHn0AyIa9QOLpt7uZyujHMY07Egun9z8e9MYpqTI33WUQnIsN669tEFE86GHpc52dIukdntLsq1c7CtRYCAkMW9gQMQFOyml8xBOGyrLkq9gCzfmVBe0QqmThvLZMSEPWxdTr7w7vSW6A8umzo7520r4WJD9VZZ6/wFxER/bRpMBrZpKAhH3vIezTGN3Ii+OcLntEoAQpW2T3JOBpXtg3bTgv6cJULkHUd2gm2LgvxMk+Xj8rnWCSFtA0Ve9kRMAdK19TKmX/X4kT94YD5TCrLQLWrqJIo=
install:
- npm install
script:
- npm run build
- npm run test
before_deploy:
- npm run release
- cd ${TRAVIS_BUILD_DIR}
deploy:
  provider: releases
  api_key:
    secure: YcHkN+WJ9ICUS8BxfyeVs1RlpnFJ02dZACvCgMC/14mib7OWUwWeDG2bnoTAAdMLO8cxaRcTz6LIdGIv0Rvx/GgO5oMIVp787MaURX2g9JJtxDDzz7ajf3NUqjkeGXqka8OaiC9t2IRROs/ymEdTawCdyMkLiOn/ouE91e/TlYdawfALcsqnEhVQ7v9TddY1Bp5dG/JpeqA3YwSSGmfBETWhFeCzXhYWylthO4tI50ELSdLpHwMLeU8PO/D0LUVSZYDtoIca3TlyzeR0cJEN315voL6QiJERtdY5Yhlpq1ejazDGjZkHqTWVdlahFeaMvKPHCT5qAfARtuCGRBT2uRHxjCq0LbYdDmJdLlKx0idsXgof+QzRP/8VyycmwyEpSdQuTRMf/hK4Lip6Kf0hJ2oU9l5s9/xdU5A4KpWiF0CKBELfCn7FsA+YGJicgOGsLimuoJ3KnZJtOy/vtv/UWbrFToJ55++3iM2fPHdHiQciRU4KeNNvIjg+BcgrZYca5ifQkJSOhnz/OiRZysvRW1jV3sxrI8F95DngqGJXo3WXSQMfjmCT3Va+JaivfmXA7m2ss7Ge7dCBkLfgCaxIyribJVJPtB7E6sg3FrVtGib0EuuGbHj4do69oCrtPe1Nj2CjNj0T8Pb1fEZazgXPEHdApMiaR08GwRz6haaCNLE=
  file:
  - eon-core/release/eon-core.zip
  - eon-ui/release/eon-ui.zip
  skip_cleanup: true
  on:
    repo: vimlet/eon
    tags: true
    all_branches: true
    condition: "$TRAVIS_TAG =~ ^release-.*$"
after_deploy:
- MESSAGE=$(git log --format=%B -n 1 $TRAVIS_COMMIT)
- cd ${TRAVIS_BUILD_DIR}
- git clone git://github.com/vimlet/eon-cdn.git
- cp -rf eon-core/build eon-cdn
- cp -rf eon-ui/build eon-cdn
- cd eon-cdn
- git remote
- git config user.email eon@mail.com
- git config user.name eon
- git add .
- git commit -am ${TRAVIS_TAG}
- git push "https://${CDN_TOKEN}@github.com/vimlet/eon-cdn.git" master > /dev/null 2>&1
- git tag ${TRAVIS_TAG}
- git push "https://${CDN_TOKEN}@github.com/vimlet/eon-cdn.git" ${TRAVIS_TAG} > /dev/null 2>&1