<template>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <div id="eon-loading-content"></div>
</template>

<script>
  eon.element({

    name: "eon-loading",
    style: "eon-loading.css",

    properties: {
        // @property animation (public) [Animation to show]
        animation: {
            value: "dots",
            reflect: true
        },
        // 
        color: {
            value: "",
            reflect: true
        }
    },

    privateProperties: {
        refs: {
            value: {}
        }
    },

    functions: {
        // @function show (public) [Shows animation]
        show: function () {
            var el = this;
            el.setAttribute("style", "display:flex;");
        },
        // @function hide (public) [Hides animation]
        hide: function () {
            var el = this;
            el.setAttribute("style", "display:none;");
        }
    },

    privateFunctions: {
        // @function setDots (private) [Set up dots animation]
        setDots: function () {
            var el = this;
            var fragment = document.createDocumentFragment();
            for (var i = 0; i < 3; i++) {
                var dot = document.createElement("div");
                dot.classList.add("eon-loading-loading-dots--dot");
                dot.style.backgroundColor = !el.color ? dot.style.backgroundColor : el.color;
                fragment.appendChild(dot);
            }
            return fragment;
        },
        // @function _storeCode (private) [Take code from inner and from html attributes]
        storeCode: function () {
            var el = this;
            var sourceCode = el.getSourceElements();
            el._childs = [];
            sourceCode.forEach(function (code) {
                el._childs.push(code);
                code.parentNode.removeChild(code);
            });
        }
    },

    onCreated: function () {
        var el = this;
        el._storeCode();
    },

    onReady: function () {
        var el = this;
        el._refs.content = el.querySelector("#eon-loading-content");
        switch (el.animation) {
            case "dots":
                el._refs.content.appendChild(el._setDots());
                break;
            case "svg":
            el._refs.content.style.visibility = "hidden";
                var fragment = document.createDocumentFragment();
                if (el._childs.length > 0) {
                    el._childs.forEach(function (child) {
                        fragment.appendChild(child);
                    });
                }
                el._refs.content.appendChild(fragment);
                setTimeout(function() {
                    if(el.querySelector("svg")){
                        el._refs.content.style.visibility="visible";
                        el._refs.content.querySelector("svg").style.visibility="visible";
                    }
                }, 0);
                break;
        }
    },

    onRender: function () {
        var el = this;
    }
  });
</script>