<template>

    <div class="vc-combobox-data">
        <label class="vc-combobox-label"></label>
    </div>

    <div class="vc-combobox-main">

        <div class="vc-combobox-wrapper vc-bg2">
            <div class="vc-combobox-input">
                <input type="text" class="vc-fg2">
            </div>
            <i class="vc-combobox-dropButton vc-fg2-hoverable vc-unselectable vicon vicon-chevron-down"></i>
        </div>

        <span class="vc-combobox-underline"></span>

    </div>

    <div class="vc-combobox-dropdown vc-sect1 vc-boxshadow2 hidden"></div>

</template>

<script type="text/javascript">
    vcomet.element("vc-combobox", "vc-combobox.css", {

        themed: true,

        dependencies: [
            "../vc-scroll",
            "../vc-item"
        ],

        privateProperties: {
            /*
            @property (private) {string} _formElement 
            @description Necessary property for a form
            */
            formElement: {
                value: "combobox"
            },
            /*
            @property {object} _refs
            @description Object with references to relevant element nodes
            */
            refs: {
                value: {},
                reflect: false
            },
            /*
            @property (private) {Object} _misc
            @description Object with usefull information
            */
            misc: {
                value: {},
                reflect: false
            },
        },

        properties: {
            /*
            @property {string} name
            @description Name of the combobox
            */
            name: {
                value: "",
                reflect: true
            },
            /*
            @property {string} filter
            @description Whether the input will be enabled to filter the dropdown options
            */
            filter: {
                value: "false",
                reflect: true,
                reflectDefault: true
            },
            /*
            @property {string} placeholder
            @description Sets the placeholder for the input
            */
            placeholder: {
                value: "",
                reflect: true
            },
            /*
            @property {string} label
            @description Sets the placeholder for the input
            */
            label: {
                value: "",
                reflect: true,
                reflectDefault: true
            },
            /*
            @property {string} displayProperty
            @description Property that will be used to get the displayValue in case a store has been provided
            */
            displayProperty: {
                value: "",
                reflect: true
            },
            /*
            @property {string} value
            @description The value of the dropdown
            */
            value: {
                value: "",
                reflect: true
            },
            /*
            @property {string} displayValue
            @description The displayValue of the item
            */
            displayValue: {
                value: "",
                reflect: true
            },
            /*
            @property {String} default
            @description Value of the element when the element is reseted, if will also be the value of the element if no value is provided
            */
            default: {
                value: "",
                reflect: true
            },
            /*
            @property {Boolean} inline 
            @description Space that occupies the button inside its parent container.
            */
            inline: {
                value: true,
                reflect: true,
                reflectDefault: true
            },
            /*
            @property {string} readonly
            @description Toggles the readonly status of the element
            */
            readonly: {
                value: false,
                reflect: true
            },
            /*
            @property {String} disabled
            @description Toggles the disabled status of the element
            */
            disabled: {
                value: false,
                reflect: true
            }
        },

        privateFunctions: {
            /*
            @function setupRefs
            @description Creates some fast access elements so that theres no need for calling the QuerySelector all the time.
            */
            setupRefs: function () {

                var el = this;

                el._refs.main = el.template.querySelector(".vc-combobox-main");
                el._refs.input = el.template.querySelector("input");
                el._refs.dropDown = el.template.querySelector(".vc-combobox-dropdown");
                el._refs.dropDownButton = el.template.querySelector(".vc-combobox-dropButton");
                el._refs.store = el.source.querySelector("vc-store");
                el._refs.underline = el.template.querySelector(".vc-combobox-underline");

                el._refs.data = el.template.querySelector(".vc-combobox-data");
                el._refs.label = el.template.querySelector(".vc-combobox-label");

            },
            /*
            @function _setupDropdown
            @description Prepares the dropdown to hold the items
            */
            setupDropdown: function () {

                var el = this;

                el._refs.scroll = document.createElement("vc-scroll");

                el._refs.scroll.thickness = 8;
                el._refs.scroll.fit = false;
                el._refs.scroll.fillContainer = false;

                el._refs.dropDown.appendChild(el._refs.scroll);

                if (vcomet.util.isTrue(el.filter)) {

                    var modalInputWrapper = document.createElement("div");

                    modalInputWrapper.classList.add("vc-combobox-modalFilter", "vc-bg8");

                    el._refs.modalInput = document.createElement("input");

                    el._refs.modalInput.classList.add("vc-fg2");
                    el._refs.modalInput.placeholder = el.placeholder != "" ? el.placeholder : "Filter";

                    el._refs.modalInput.addEventListener('focus', function (e) {
                        // When the device modal input is focused, it shows the keyboard, this keyboard triggers onWindowResize, 
                        // since onWindowResize we want to hide the dropdown this variable helps us know
                        //  if the resize event was triggered by the input or the window manually resizing
                        el._misc.modal.inputFocus = true;
                    }, false);

                    el._refs.modalInput.addEventListener('blur', function (e) {
                        el._misc.modal.inputFocus = false;
                    }, false);

                    el._refs.modalInput.addEventListener("keyup", function (e) {
                        el._filter();
                    });

                    modalInputWrapper.appendChild(el._refs.modalInput);
                    el._refs.dropDown.insertBefore(modalInputWrapper, el._refs.dropDown.childNodes[0]);
                }

            },
            /*
            @function _setupType
            @description Depending on user specifications we will prepare the element
            */
            setupType: function () {

                var el = this;

                if (!vcomet.util.isTrue(el.filter)) {

                    el._refs.main.classList.add("vc-fg1-hoverable");
                    el._refs.main.querySelector("input").setAttribute("disabled", "disabled");

                } else {

                    el._refs.input.addEventListener("blur", function () {

                        if (!el.isOnPath && !el._refs.dropDown.isOnPath) {
                            // When blur occurs and no item has been selected when clear the input
                            if (el.value == "") {
                                el._refs.input.value = "";
                            }
                        }

                    });

                    el._refs.input.addEventListener("focus", function (e) {
                        el.expand();
                    });

                    el._refs.input.addEventListener("keyup", function (e) {
                        el._filter();
                    });

                }

            },
            /*
            @function _setupMisc
            @description Sets up the listener to the click events
            */
            setupMisc: function () {

                var el = this;

                el._misc.modal = {};
                el._misc.items = {};

            },
            /*
            @function setupTriggers
            @description Sets up the listener to the click events
            */
            setupTriggers: function () {

                var el = this;
                var clickTarget = vcomet.util.isTrue(el.filter) ? el._refs.dropDownButton : el._refs.main;

                clickTarget.addEventListener("click", function () {
                    el._toggleDropdown(el);
                });

                document.body.addEventListener("click", function (e) {
                    if (!el.isOnPath && !el._refs.dropDown.isOnPath && !el._refs.overlay.classList.contains("vc-combobox-device")) {
                        el._refs.input.blur();
                        el.shrink();
                    }
                });

            },
            /*
            @function setupAnimations
            @description Here we will setup the animations for the input
            */
            setupAnimations: function () {

                var el = this;

                el._refs.input.addEventListener("focus", function () {
                    el._refs.underline.classList.add("animate");
                });

                el._refs.input.addEventListener("blur", function () {
                    el._refs.underline.classList.remove("animate");
                });

            },
            /*
            @function (private) _setupOverlay
            @description Sets up basic properties for the data object
            */
            setupOverlay: function () {

                var el = this;

                el._refs.overlay = document.createElement("div");
                el._refs.overlay.classList.add("vc-combobox-overlay", "vc-bg1-modal");
                el._refs.overlay.appendChild(el._refs.dropDown);

                // Prevents scrolling on mobile devices
                window.addEventListener("touchstart", function (e) {
                    if (el._misc.modal.active && el._refs.overlay.classList.contains("vc-combobox-device")) {
                        if (!el._refs.dropDown.isOnPath) {
                            e.preventDefault();
                            e.stopPropagation();
                            el._misc.modal.blur = true;
                        }
                    }
                }, { passive: false });

                // On touch end it blurs the modal dropdown
                window.addEventListener("touchend", function (e) {
                    if (el._misc.modal.active && el._refs.overlay.classList.contains("vc-combobox-device") && el._misc.modal.blur) {
                        el._misc.modal.blur = false;
                        el.shrink();
                    }
                });

            },
            /*
            @function setupItems
            @description Takes all the items and moves them
            */
            setupItems: function () {

                var el = this;

                if (el._refs.store) {

                    el._refs.store.onCreated(function () {

                        el._refs.store.onLoaded(function () {

                            el._refs.store.listRemote(function () {
                                el._setupStoreItems(el);
                            });

                            el._refs.store.onSourceChanged(function () {
                                el._setupStoreItems(el);
                            });

                        });

                    });

                } else {

                    var sourceNodes = this.getSourceElements();
                    var itemsDocFragment = document.createDocumentFragment();
                    var length = sourceNodes.length;
                    var item;

                    for (var i = 0; i < length; i++) {

                        item = sourceNodes[i];

                        el._setupItem(item);

                        el._misc.items[item.value] = item;

                        itemsDocFragment.appendChild(item);

                    }

                    el._refs.scroll.content.appendChild(itemsDocFragment);

                    el._initValue();

                }

            },
            /*
            @function setupItem
            @description Takes a single item, adds its events and assigns its properties
            */
            setupItem: function (item) {

                var el = this;

                item.onRender(function () {

                    var span = document.createElement("span");

                    this.classList.add("result", "vc-bg1-hoverable", "vc-fg1-hoverable");
                    this.matches = "true";
                    this.value = this.getAttribute("value");
                    this.displayValue = this.getAttribute("display-value") || this.value;

                    span.innerHTML = this.displayValue;

                    this.appendChild(span);
                    this.addEventListener("click", function () {
                        el.select(this)
                    });
                    this.addEventListener("pointerdown", function (e) {
                        // Solves other vComet elements bug related to blur event functionality
                        e.stopPropagation();
                    });

                });

            },
            /*
            @function setupStoreItems
            @description Here we setup our items depending on the store data
            */
            setupStoreItems: function () {

                var el = this;

                var dropdown = el._refs.dropDown;
                var itemsDocFragment = document.createDocumentFragment();
                var displayProperty = (el.displayProperty != "") ? el.displayProperty : el._refs.store.idProperty;
                var storeData = el._refs.store.data.asObject();
                var item;

                for (var key in storeData) {

                    item = document.createElement("vc-item");

                    item.classList.add("vc-bg1-hoverable", "vc-fg1-hoverable");
                    item.matches = "true";
                    item.value = storeData[key][el._refs.store.idProperty];
                    item.displayValue = storeData[key][displayProperty];

                    el._misc.items[item.value] = item;

                    item.onRender(function () {

                        var span = document.createElement("span");

                        span.innerHTML = this.displayValue;
                        this.appendChild(span);
                        this.addEventListener("click", function () { el.select(this) });
                    });

                    itemsDocFragment.appendChild(item);

                }

                el._refs.scroll.content.appendChild(itemsDocFragment);

                el._initValue();

            },
            /*
            @function (private) {String} _setupTouchBlur
            @description Creates the touch blur
            */
            setupTouchBlur: function () {

                var el = this;
                var blurTrigger = vcomet.util.isTouchScreen() ? "touchend" : "click";

                vcomet.registerPathListener(el);
                vcomet.registerPathListener(el._refs.dropDown);

                document.addEventListener(blurTrigger, function () {
                    if (!el.isOnPath && !el._refs.dropDown.isOnPath && !el._refs.overlay.classList.contains("vc-combobox-device")) {
                        el._refs.input.blur();
                        el.shrink();
                    }
                });

            },
            /*
            @function (private) _setupMatchingErrorItem
            @description Creates the touch blur
            */
            setupMatchingErrorItem: function () {

                var el = this;

                el._refs.matchingErrorItem = document.createElement("div");
                el._refs.matchingErrorItem.classList.add("vc-combobox-matchingError");
                el._refs.matchingErrorItem.innerHTML = "No matches found";

            },
            /*
            @function (private) _initDefault
            @description If a value has been provided by the user we set it for our element
            */
            initDefault: function () {
                this.value = this.default != "" && this.value == "" ? this.default : this.value;
            },
            /*
            @function (private) _initValue
            @description Sets the initial value depending if an item with the provided value exists
            */
            initValue: function () {

                var el = this;

                if (el.value != "" && el._misc.items.hasOwnProperty(el.value)) {
                    el.select(el._misc.items[el.value]);
                }

            },
            /*
            @function (private) _filter
            @description Takes the value of the input and filters the dropdown items
            */
            filter: function () {

                var el = this;

                var items = el._refs.dropDown.querySelectorAll("vc-item");
                var value = el._misc.modal.inputFocus ? el._refs.modalInput.value.toLowerCase() : el._refs.input.value.toLowerCase();

                //Check if its already expanded, if its not then expand it
                if (el._refs.dropDown.classList.contains("hidden")) {
                    el.expand();
                }

                //Loop to find matches and hide those that do not match
                for (var i = 0; i < items.length; i++) {

                    if (!(items[i].getAttribute("display-value").toLowerCase().match("^" + value))) {

                        if (!items[i].classList.contains("hidden")) {
                            items[i].classList.add("hidden");
                            items[i].setAttribute("matches", "false");
                        }

                    } else {

                        if (items[i].classList.contains("hidden")) {
                            items[i].classList.remove("hidden");
                            items[i].setAttribute("matches", "true");
                        }

                    }

                }

                var matchedItems = el._refs.dropDown.querySelectorAll('[matches="true"]');

                if (matchedItems.length == 0) {

                    el._showMatchingError();

                } else {

                    el._hideMatchingError();

                }

                el._value = "";
                el.displayValue = "";

            },
            /*
            @function (private) _undoFilter
            @description Shows all the previously filtered items
            */
            undoFilter: function () {

                var el = this;
                var hiddenItems = el._refs.dropDown.querySelectorAll('[matches="false"]');

                for (var i = 0; i < hiddenItems.length; i++) {
                    hiddenItems[i].setAttribute("matches", "true");
                    hiddenItems[i].classList.remove("hidden");
                }

                el._hideMatchingError();

                // We set the modalInput value to empty in case its been used to filter
                if (el._refs.modalInput) {
                    el._refs.modalInput.value = "";
                }

            },
            /*
            @function (private) _showMatchingError
            @description Shows matching error on the dropdown
            */
            showMatchingError: function () {

                var el = this;

                el._refs.scroll.content.appendChild(el._refs.matchingErrorItem);
                el.classList.add("noMatches");

            },
            /*
            @function (private) _hideMatchingError
            @description Hides matching error on the dropdown
            */
            hideMatchingError: function () {

                var el = this;

                if (el._refs.matchingErrorItem.parentNode) {

                    el._refs.matchingErrorItem.parentNode.removeChild(el._refs.matchingErrorItem);
                    el.classList.remove("noMatches");

                }

            },
            /*
            @function toggleDropdown
            @description Toggles the dropdown when clicking on the dropdown button
            */
            toggleDropdown: function () {

                var el = this;

                if (!el._refs.dropDown.classList.contains("hidden")) {
                    // el.shrink();
                } else {
                    el.expand();
                }
            },
            /*
            @function (private) _assignDropdownStyle
            @description Assigns the datePicker's width and position relative to the datebox
            */
            assignDropdownStyle: function () {

                var el = this;

                if (window.innerWidth <= vcomet.tabletWidth) {

                    if (!el._refs.overlay.classList.contains("vc-combobox-device")) {

                        el._refs.dropDown.style.top = "auto";
                        el._refs.dropDown.style.left = "auto";

                        el._refs.overlay.classList.add("vc-combobox-device");
                        el._refs.overlay.classList.add("vc-bg1-modal");

                    }

                } else {

                    el._refs.overlay.classList.remove("vc-combobox-device");
                    el._refs.overlay.classList.remove("vc-bg1-modal");

                    el._refs.dropDown.style.top = el.getBoundingClientRect().top + el.offsetHeight + 1 + "px";
                    el._refs.dropDown.style.left = el.getBoundingClientRect().left + "px";
                    el._refs.dropDown.style.width = el.offsetWidth + "px";

                }

            },
            /*
            @function (private) _updateLabel
            @description Updates the label node with the new label
            */
            updateLabel: function () {

                var el = this;

                if (el.label != "") {
                    el.querySelector(".vc-combobox-label").innerHTML = el.label;
                }

            },
            /*
            @function (private) _updateDisabled
            @description Updates disabled status
            */
            updateDisabled: function () {

                var el = this;
                var typingNode = el.type == "area" ? el._refs.editableArea : el._refs.input;

                if (!vcomet.util.isTrue(el.disabled)) {

                    el._refs.input.classList.add("vc-fg2");
                    el._refs.input.classList.remove("vc-fg2-disabled");

                    el._refs.data.classList.remove("vc-fg2-disabled");
                    el._refs.main.classList.remove("vc-fg2-disabled");

                    el.removeAttribute("disabled");
                    el._refs.input.removeAttribute("disabled");

                } else {

                    el._refs.input.setAttribute("disabled", "true");

                    el._refs.input.classList.remove("vc-fg2");
                    el._refs.input.classList.add("vc-fg2-disabled");

                    el._refs.data.classList.add("vc-fg2-disabled");
                    el._refs.main.classList.add("vc-fg2-disabled");

                }
            },
            /*
            @function (private) _updateReadOnly
            @description Updates readonly status
            */
            updateReadOnly: function () {

                var el = this;

                if (!vcomet.util.isTrue(el.readonly)) {

                    el.removeAttribute("readonly");
                    el._refs.input.removeAttribute("readonly");

                } else {

                    el._refs.input.setAttribute("readonly", "true");

                }

            },
            /*
            @function (private) _updateValue
            @description Updates the value
            */
            updateValue: function () {

                var el = this;
                var item = el._misc.items[el.value];

                if (item) {

                    var value = item.value;
                    var displayValue = item.displayValue;

                    el.displayValue = displayValue;

                    el._refs.input.value = item.displayValue;

                } else {

                    el._value = "";
                    el.displayValue = "";
                    el._refs.input.value = "";

                }

            },
            /*
            @function (private) _assignModalStyle
            @description Handles the overlay modal style
            */
            assignModalStyle: function () {

                var el = this;

                // Gets the body style from two different sources
                var computedStyle = window.getComputedStyle(document.body);
                var boundingClientRect = document.body.getBoundingClientRect();

                //  Checks if there are vertical/horizontal scrolls on window
                var windowHasVerticalScroll = (document.body.scrollHeight - window.innerHeight) > 0;
                var windowHasHorizontalScroll = (document.body.scrollWidth - window.innerWidth) > 0;

                // Gets all the margins of the body
                var horizontalMarginSpace = parseFloat(computedStyle.marginLeft) + parseFloat(computedStyle.marginRight) / 2;
                var verticalMarginSpace = parseFloat(computedStyle.marginTop) + parseFloat(computedStyle.marginBottom) / 2;

                var widthDifferenceCalc = (parseInt(boundingClientRect.width) - parseInt(computedStyle.width)) / 2;

                var verticalCalc = parseInt(window.innerWidth + window.pageXOffset + widthDifferenceCalc - document.body.clientWidth);
                var horizontalCalc = parseInt(window.innerHeight - (boundingClientRect.height + boundingClientRect.top));
                var scrollBarWidth = vcomet.util.getBrowserScrollBarWidth();

                el._misc.modal.verticalAdjustement = windowHasVerticalScroll && (verticalCalc >= 0 && verticalCalc <= scrollBarWidth);
                el._misc.modal.horizontalAdjustement = windowHasHorizontalScroll && (horizontalCalc >= 0 && horizontalCalc <= scrollBarWidth);

                // Adjusts the body style to keep it visually intact when adding overflow
                if (el._misc.modal.verticalAdjustement || el._misc.modal.horizontalAdjustement) {

                    if (el._misc.modal.verticalAdjustement) {

                        // Saves and assigns a width and Left style
                        el._misc.modal.previousStyleWidth = parseInt(document.body.style.width);
                        el._misc.modal.previousStyleLeft = parseInt(document.body.style.left);

                        document.body.style.width = document.body.offsetWidth + "px";
                        document.body.style.left = boundingClientRect.left + "px";

                    }

                    if (el._misc.modal.horizontalAdjustement) {

                        // Saves and assigns a top style
                        el._misc.modal.previousStyleTop = parseInt(document.body.style.top);
                        document.body.style.top = boundingClientRect.top + "px";

                    }

                    // Saves and assigns a position style
                    el._misc.modal.previousStylePosition = document.body.style.position;
                    document.body.style.position = "absolute";

                    // Shows/Hides the disabled scrollbars in the overlay
                    el._refs.overlay.style.overflowY = windowHasVerticalScroll ? "scroll" : "";
                    el._refs.overlay.style.overflowX = windowHasHorizontalScroll ? "scroll" : "";

                    document.body.classList.add("vc-body-modal");

                }

            },
            /*
            @function (private) _revertModalStyle
            @description Reverts the assigned modal style
            */
            revertModalStyle: function () {

                var el = this;

                document.body.classList.remove("vc-body-modal");

                // Removes the modal style and restores the previous style 
                document.body.style.width = el._misc.modal.previousStyleWidth ? el._misc.modal.previousStyleWidth : "";
                document.body.style.left = el._misc.modal.previousStyleLeft ? el._misc.modal.previousStyleLeft : "";
                document.body.style.top = el._misc.modal.previousStyleTop ? el._misc.modal.previousStyleTop : "";
                document.body.style.position = el._misc.modal.previousStylePosition ? el._misc.modal.previousStylePosition : "";

                el._misc.modal.previousStyleWidth = undefined;
                el._misc.modal.previousStyleLeft = undefined;
                el._misc.modal.previousStyleTop = undefined;
                el._misc.modal.previousStylePosition = undefined;

            },

        },

        functions: {
            /*
            @function addItem
            @description Adding a new option item programmaticaly
            @param {object} item 
            */
            addItem: function (item) {

                var el = this;

                el._misc.items[item.value] = item;

                item.onRender(function () {
                    var span = document.createElement("span");
                    span.innerHTML = this.displayValue;
                    this.classList.add("result", "vc-bg1-hoverable", "vc-fg1-hoverable")
                    this.appendChild(span);
                    this.setAttribute("matches", "true");
                    this.addEventListener("click", function () { el.select(this) });
                });

                el._refs.scroll.content.appendChild(item);
                el._refs.scroll.update();
            },
            /*
            @function select
            @description Sets the item as the inputs value and hide the options div
            @param {object} item
            */
            select: function (item) {
                var el = this;

                var value = item.value;
                var displayValue = item.displayValue;

                el.value = value;
                el.displayValue = displayValue;

                el._refs.input.value = item.displayValue;

                vcomet.triggerCallback("onSelected", el, el, [item]);

                el.shrink();

            },
            /*
            @function expand
            @description Expands the items dropdown
            */
            expand: function () {

                var el = this;

                el._assignModalStyle();
                el._assignDropdownStyle();

                el._refs.scroll.scrollTop = 0;

                el._refs.dropDown.classList.remove("hidden");
                el._refs.underline.classList.add("animate");

                el.classList.add("focus");

                el._undoFilter();

                document.body.appendChild(el._refs.overlay);

                // el._refs.scroll.update();
                setTimeout(function () {
                    el._refs.scroll.update();
                }, 100);

                el._misc.modal.active = true;

            },
            /*
            @function shrink
            @description Shrinks the items dropdown
            */
            shrink: function () {

                var el = this;

                el._refs.dropDown.classList.add("hidden");
                el._refs.underline.classList.remove("animate");

                // el.appendChild(el._refs.dropDown);
                if (el._refs.overlay.parentNode) {
                    el._refs.overlay.parentNode.removeChild(el._refs.overlay);
                }

                if (el._misc.modal.active) {
                    el._revertModalStyle();
                }

                el._misc.modal.active = false;
                el._misc.modal.inputFocus = false;

            },
            /*
            @function clear
            @description Empties the value
            */
            clear: function () {
                this.value = "";
            },
            /*
            @function reset
            @description Resets the value of the element to the default one, if no default is provided then empties the value
            */
            reset: function () {

                var el = this;

                if (el.default != "") {
                    el.value = el.default;
                } else {
                    el.clear();
                }

            }

        },

        onCreated: function () {

            var el = this;

            el._setupMisc();
            el._setupRefs();
            el._setupDropdown();

            vcomet.createCallback("onSelected", el);

        },

        onInit: function () {

            var el = this;

            var declarativePlaceholder = el.getAttribute("placeholder");

            el._setupTriggers();
            el._setupAnimations();
            el._setupTouchBlur();
            el._setupMatchingErrorItem();

            el._updateLabel();
            el._updateDisabled();
            el._updateReadOnly();

            el._setupType();
            el._setupOverlay();

            el._initDefault();

            if (declarativePlaceholder) el._refs.input.placeholder = declarativePlaceholder;

        },

        onRender: function () {

            var el = this;

            el._setupItems();

        },

        onPropertyChanged: function (key, oldVal, newVal) {

            switch (key) {
                case "label":
                    this._updateLabel();
                    break;
                case "disabled":
                    this._updateDisabled();
                    break;
                case "readonly":
                    this._updateReadOnly();
                    break;
                case "value":
                    this._updateValue();
                    break;
            }

        },
        onWindowResize: function () {

            var el = this;

            if (el._misc.modal.active && !el._misc.modal.inputFocus) {
                el.shrink();
            }

        }
    });
</script>