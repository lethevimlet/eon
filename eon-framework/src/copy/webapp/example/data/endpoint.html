<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">

  <!-- Import VimletJS  -->
  <title>eon ENDPOINT</title>
  <script src="/eon/eon.js"></script>

  <!-- Example style -->
  <link rel="stylesheet" href="/example/data/css/style.css">
  <link rel="stylesheet" href="/example/data/css/store.css">

  <!-- UI components -->
  <script>
    eon.import([
      "/eon/ui/eon-text",
      "/eon/ui/eon-checkbox",
      "/eon/ui/eon-scroll"
    ]);
  </script>
  <style>
    .twoRows {
      width: 100%;
    }

    .result {
      font-size: 17px;
    }

    .status {
      border-radius: 20px;
      display: inline-block;
      height: 10px;
      width: 10px;
      margin-right: 3px;
    }

    .status-ok {
      background-color: green;
    }

    .status-error {
      background-color: red;
    }
  </style>
</head>

<body>

  <div class="container">
    <div class="card">

      <h1>REST</h1>

      <div class="row">
        <button onclick="get()">
          GET
        </button>
        <button onclick="post()">
          POST
        </button>
        <button onclick="put()">
          PUT
        </button>
        <button onclick="deletion()">
          DELETE
        </button>
      </div>

      <div class="twoRows">
        <div class="twoColumns" style="margin-bottom: 6px;">
          <div class="example twoRows">
            <h4 class="title">REQUEST</h4>
            <eon-scroll class="flexStretch resultClass" thickness="8">
              <div id="request" class="result"></div>
            </eon-scroll>
          </div>
        </div>
      </div>

      <div class="twoRows">
        <div class="twoColumns" style="margin-bottom: 6px;">
          <div class="example twoRows">
            <h4 class="title">RESPONSE</h4>
            <eon-scroll class="flexStretch resultClass" thickness="8">
              <pre id="response" class="result"></pre>
            </eon-scroll>
          </div>
        </div>
      </div>

      <h1>Graph QL</h1>

      <div class="row">
        <button onclick="send()">
          SEND
        </button>
        <button onclick="query()">
          QUERY
        </button>
        <button onclick="mutation()">
          MUTATION
        </button>
        <button onclick="subscribe()">
          SUBSCRIBE
        </button>
      </div>

      <div class="twoRows">
        <div class="twoColumns" style="margin-bottom: 6px;">
          <div class="example twoRows">
            <h4 class="title">REQUEST</h4>
            <eon-scroll class="flexStretch resultClass" thickness="8">
              <div id="graphRequest" class="result"></div>
            </eon-scroll>
          </div>
        </div>
      </div>

      <div class="twoRows">
        <div class="twoColumns" style="margin-bottom: 6px;">
          <div class="example twoRows">
            <h4 class="title">RESPONSE</h4>
            <eon-scroll class="flexStretch resultClass" thickness="8">
              <pre id="graphResponse" class="result"></pre>
            </eon-scroll>
          </div>
        </div>
      </div>

    </div>
  </div>


  <!-- eon-store usage -->
  <script>

    var requestField, responseField;

    eon.onReady(function () {
      // Fields
      requestField = document.querySelector("#request");
      responseField = document.querySelector("#response");

      requestGraphField = document.querySelector("#graphRequest");
      responseGraphField = document.querySelector("#graphResponse");
    });


    // -- REST API --
    // Create endpoint
    var endpoint = new eon.endpoint("rest", "https://reqres.in/api/users");
    var statusClass = "status-ok";

    // :: READ
    function get() {
      // Get request
      endpoint.get("", function (success, data) {
        console.log('### REST get data', data);

        // Check status
        statusClass = data.status >= 200 && data.status < 300 ? "status-ok" : "status-error";
        requestField.innerHTML = "Request URL: " + data.url + "<br>" +
          "Request method: " + data.method + "<br>";
        // Display response
        responseField.innerHTML = "Status code: <span class='status " + statusClass + "'></span>" + data.status + "<br>" +
          "Body: " + data.responseText;
      });
    }
    // :: POST
    function post() {
      var payload = { name: "Samuel", employed: false };
      // Post request
      endpoint.post(payload, function (success, data) {
        console.log('### REST post data', data);

        // Check status
        statusClass = data.status >= 200 && data.status < 300 ? "status-ok" : "status-error";
        requestField.innerHTML = "Request URL: " + data.url + "<br>" +
          "Request method: " + data.method + "<br>" +
          "Payload: " + JSON.stringify(payload, null, 2);
        // Display response
        responseField.innerHTML = "Status code: <span class='status " + statusClass + "'></span>" + data.status + "<br>" +
          "Body: " + data.responseText;
      });
    }
    // :: PUT
    function put() {
      var payload = { name: "Samuel", employed: true };
      // Put request
      endpoint.put("1", payload, function (success, data) {
        console.log('### REST put data', data);
        // Check status
        statusClass = data.status >= 200 && data.status < 300 ? "status-ok" : "status-error";
        requestField.innerHTML = "Request URL: " + data.url + "<br>" +
          "Request method: " + data.method + "<br>" +
          "Payload: " + JSON.stringify(payload, null, 2);
        // Display response
        responseField.innerHTML = "Status code: <span class='status " + statusClass + "'></span>" + data.status + "<br>" +
          "Body: " + data.responseText;
      });
    }
    // :: DELETE
    function deletion() {
      // Delete request
      endpoint.delete("1", function (success, data) {
        console.log('### REST delete data', data);
        // Check status
        statusClass = data.status >= 200 && data.status < 300 ? "status-ok" : "status-error";
        requestField.innerHTML = "Request URL: " + data.url + "<br>" +
          "Request method: " + data.method + "<br>";
        // Display response
        responseField.innerHTML = "Status code: <span class='status " + statusClass + "'></span>" + data.status + "<br>" +
          "Body: " + JSON.stringify({ name: "Samuel", employed: true }, null);
      });
    }

    // -- GRAPHQL HTTP BASED --
    // Create endpoint
    var endpointHTTP = new eon.endpoint("graphHTTP", "https://1jzxrj179.lp.gql.zone/graphql");

    // :: SEND
    function send() {
      var query = "{ posts { title } }";
      // Put request
      endpointHTTP.send(query, function (success, data) {
        console.log('### GraphQL send data', data);
        // Check status
        statusClass = data.status >= 200 && data.status < 300 ? "status-ok" : "status-error";
        requestGraphField.innerHTML = "Request URL: " + data.url + "<br>" +
          "Request method: " + data.method + "<br>";
        // Display response
        responseGraphField.innerHTML = "Status code: <span class='status " + statusClass + "'></span>" + data.status + "<br>" +
          "Body: " + data.responseText;
      });
    }
    // :: QUERY
    function query() {
      var query = "{ posts { title } }";
      // Put request
      endpointHTTP.query(query, function (success, data) {
        console.log('### GraphQL query data', data);
        // Check status
        statusClass = data.status >= 200 && data.status < 300 ? "status-ok" : "status-error";
        requestGraphField.innerHTML = "Request URL: " + data.url + "<br>" +
          "Request method: " + data.method + "<br>";
        // Display response
        responseGraphField.innerHTML = "Status code: <span class='status " + statusClass + "'></span>" + data.status + "<br>" +
          "Body: " + data.responseText;
      });
    }
    // :: MUTATION
    function mutation() {
      var query = "{ posts { title } }";
      // Put request
      endpointHTTP.mutation(query, function (success, data) {
        console.log('### GraphQL mutation data', data);
        // Check status
        statusClass = data.status >= 200 && data.status < 300 ? "status-ok" : "status-error";
        requestGraphField.innerHTML = "Request URL: " + data.url + "<br>" +
          "Request method: " + data.method + "<br>";
        // Display response
        responseGraphField.innerHTML = "Status code: <span class='status " + statusClass + "'></span>" + data.status + "<br>" +
          "Body: " + data.responseText;
      });
    }

    // -- GRAPHQL WEB SOCKETS BASED --
    // Create endpoint
    var endpointSockets = new eon.endpoint("graphSockets", "wss://echo.websocket.org");

    // :: SUBSCRIBE
    function subscribe() {
      // ** Change endpointurl type
      var query = JSON.stringify("{ posts { title } }");
      // Put request
      endpointSockets.subscribe(query, function (success, data) {
        console.log('### GraphQL subscription', data);
        // Check status
        statusClass = data.status >= 200 && data.status < 300 ? "status-ok" : "status-error";
        requestGraphField.innerHTML = "Origin: " + data.origin + "<br>" +
          "Type: Web Sockets <br>" +
          "Query: " + data.data;
        // Display response
        responseGraphField.innerHTML = "Message: { posts: [{title: Apps}, {title: References}] }";
      });
    }

  </script>
</body>

</html>