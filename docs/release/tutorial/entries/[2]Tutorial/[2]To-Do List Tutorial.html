<!DOCTYPE html>
<html>
<style>
@font-face {
  font-family: 'Roboto';
  font-style: normal;
  font-weight: 400;
  src: url('../../fonts/Roboto/Roboto-Regular.ttf');
}
@font-face {
  font-family: 'Inconsolata';
  font-style: normal;
  font-weight: 400;
  src: url('../../fonts/Inconsolata/Inconsolata-Regular.ttf');
}
body{
    background-color: #fff !important;
      font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif !important;
      padding: 0px !important;
      overflow:hidden;
      font-size: 17.5px;
}
.container{
  padding-top:20px;
  padding-right:46px !important;
    margin-left:35px !important;
  width:auto !important;
  position:relative;
  overflow-y:auto;
    height: -webkit-fill-available;
}
.table-striped tbody tr:nth-child(odd) td, .table-striped tbody tr:nth-child(odd) th {
    background-color: #d2d2d2 !important;
}
a{
  color:blue !important;
}
h1, h2, h3, h4, h5, h6{
    text-shadow: none !important;
}
.table {
    border-radius: 0 !important;
    border: 1px solid rgba(0, 0, 0, 0.15) !important;
}
.table-bordered thead:first-child tr:first-child th:first-child, .table-bordered tbody:first-child tr:first-child td:first-child{
    border-radius: 0 !important;
    border: 1px solid rgba(0, 0, 0, 0.15) !important;
}
.table-bordered th, .table-bordered td {
    border-radius: 0 !important;
    border: 1px solid rgba(0, 0, 0, 0.15) !important;
}

.vCodeBlock{
  display: block !important;
  margin-bottom:10px;
  height:auto !important;
    border-radius: 3px;

}
.tip {
    background-color: rgb(36, 36, 41);
    border-radius: 2px;
    padding: 2px 4px;
    color: white;
    display: inline-block;
}
.tip i{
    margin-right:5px;
}

code, pre{
    border: 1px solid rgba(0, 0, 0, 0.15) !important;
    font-family: "Inconsolata", "Helvetica Neue", Helvetica, Arial, sans-serif !important;
    font-size: 17.5px!important;
}
pre code{
  border:none !important;
  font-size: 17.5px!important;
}



/* Perfect scrollbar */
.ps__thumb-y, .ps__thumb-x{
  background-color: #6b6b6b !important;
}
.ps__thumb-y{
width:11px !important;
}
.ps__thumb-x{
height:11px !important;
}
.ps > .ps__rail-x,
.ps > .ps__rail-y {
  background-color:transparent;
  /*  background-color: #d2d2d2 !important;*/
    display: block !important;
}
.ps > .ps__rail-y {
background-color: #cbcbcb !important;
/*  opacity: 0.6;*/
  /*height:100% !important;*/
}



.colorBand{
  width:100%;
  height:5px;
  background-color: #333333;
  margin-top: 50px;
}


video{
  max-width: 100%;
}
.video-js{
  max-width: 100%;
  margin-bottom:20px;
}


.video-js .vjs-big-play-button {
  top:calc(50% - 0.75em) !important;
  left: calc(50% - 1.5em) !important;
}

.selectDisabled {
    -webkit-appearance: none;
    -moz-appearance: none;
    text-indent: 1px;
    text-overflow: '';
}


@font-face {
  font-family: 'Inconsolata';
  font-style: normal;
  font-weight: 400;
  src: url('../../fonts/Inconsolata/Inconsolata-Regular.ttf');
}
.vGround {
  width: 100%;
  margin-bottom:20px;
}
.vGroundMenu {
    box-sizing: border-box;
  display: flex;
  flex-direction: row;
  width: 100%;
  height: 50px;
  align-items: flex-end;
    color: hsl(220, 14%, 71%);
}
.vGroundMenuButton{
  min-width:60px;
    text-align: center;
    padding: 2px 4px;
    box-sizing: border-box;
    cursor:pointer;
    background-color: #fff;
    color: #6b6b6b;
}
.vGroundMenuShowHead{
  margin-left: auto;
   margin-right: 10px; 
}
.vGroundMenuButton:hover{
  color:white;
    background-color:#bebebe;
}
.vGroundMenuActive{
  color:white;
    background-color:#18c796;
}

.vGroundContent {
  font-family: "Inconsolata", "Helvetica Neue", Helvetica, Arial, sans-serif !important;
  width: calc(100% - 12px);
  height: 340px !important;
  border: 1px solid hsl(220, 13%, 18%);
  box-shadow:none;
  border-radius: 0;
  position:relative;
  resize:none;
  display:none;
}

.vGroundIframe{
  font-family: "Inconsolata", "Helvetica Neue", Helvetica, Arial, sans-serif !important;
  width: calc(100% - 12px);
  height: 340px;
    border: 1px solid rgba(0, 0, 0, 0.15);
  box-shadow:none;
  border-radius: 0;
  resize:none;
  background-color:white;
  display:none;
}

.CodeMirror{  
  margin: 0px 0px 10px 0px !important;
}

.cm-s-one-dark .CodeMirror, .cm-s-one-dark .CodeMirror-scroll {
  font-family: "Inconsolata, Monaco, Consolas, "Courier New", Courier"!important;
  /*    font-size: 14px!important;*/
}

.CodeMirror-line {
  border: 0 !important;
}

.CodeMirror textarea {
  display: block !important;
}

.CodeMirror-scroll {
  overflow-x: auto;
  overflow-y: hidden;
  height: auto;
  max-height: 600px;
  cursor: text;
  background-color: hsl(220, 13%, 18%) !important;
  line-height: 100% !important;
}

.cm-s-one-dark .CodeMirror-linenumber {
  min-width: auto !important;
  min-width: 20px !important;
  padding: 0 !important;
  padding-right: 20px !important;
  text-align: right !important;
  white-space: normal !important;
  background-color: hsl(220, 13%, 18%) !important;
}

.CodeMirror-gutters {
  border: none !important;
  background-color: hsl(220, 13%, 18%) !important;
}
.cm-s-one-dark .CodeMirror-linenumber {
  color: #bebebe !important;
  font-size: 14px!important;
}

.vCodeBlock .CodeMirror-cursor {
  display: none !important;
}
.CodeMirror-selected {
  background: hsl(220, 60%, 28%) !important;
}
.cm-s-blackboard .CodeMirror-line::selection, .cm-s-blackboard .CodeMirror-line > span::selection, .cm-s-blackboard .CodeMirror-line > span > span::selection {
background-color:#CC0000 !important;
}

.CodeMirror{  
  margin: 20px 0px;
}
/* As strapdown uses google prettify for code blocks (```code``` and `code`) we need to override
all colors at `code` which will be used as simple text. Code blocks ```code``` will be parsed
via codeMirror */
.pln { color: black !important; }

@media screen {
  .str { color: black !important; }
  .kwd { color: black !important; }
  .com { color: black !important; }
  .typ { color: black !important; }
  .lit { color: black !important; }
  /* punctuation, lisp open bracket, lisp close bracket */
  .pun, .opn, .clo { color: black !important; }
  .tag { color: black !important; }
  .atn { color: black !important; }
  .atv { color: black !important; }
  .dec, .var { color: black !important; }
  .fun { color: color: black !important; }
}


@media print, projection {
  .str { color: black !important; }
  .kwd { color: black !important;}
  .com { color: black !important;}
  .typ { color: black !important;}
  .lit { color: black !important; }
  .pun, .opn, .clo { color: black !important; }
  .tag { color: black !important;}
  .atn { color: black !important; }
  .atv { color: black !important; }
}


h1, h2, h3, h4, h5, h6, p{
  max-width:900px;
}
h1, h2, h3, h4{
  margin: 35px 0px 20px 0px !important;
}
p, ul, .prettyprint lang- prettyprinted{
  font-size: 17.5px;
}
</style>
<xmp theme="slate" style="display:none;">

  

  # Using Components
In this tutorial we are going to make a simple To-Do List to teach you about some of the most basic components vComet offers, and to show you how easy it is getting used to them.

## Import components
To create the To-Do List we are going to use 4 components only:  `vc-text`, `vc-button`, `vc-checkbox` and `vc-scroll`. The first thing do is import them into the html file:

<textarea class="vCodeBlock" language="html"><script>
    vcomet.import([
        "vcomet/ui/vc-text.html",
        "vcomet/ui/vc-button.html",
        "vcomet/ui/vc-checkbox.html",
        "vcomet/ui/vc-scroll.html"
    ]);
</script></textarea>

Since we need to import multiple components we are passing an `Array` with their paths, but you can also pass a single `String` path if you only want to import one.

 ## Declare components
 We are going to declare components that will be loaded with the document, that is, those that are not created by the user interaction. In order To-Do this, we are going to use HTML tags, but with vComet nomenclature.

<textarea class="vCodeBlock" language="html"><div class="main">
    <div class="absoluteContainer">
            <div class="todoContainer">
                <span class="title">To-Do list</span>

                <!-- Scroll component that will allow us to scroll through our list -->
                <vc-scroll thickness="5" fillContainer="false">
                    <!-- It will contain the elements to the list that are added. -->
                    <div class="listContainer"></div>
                </vc-scroll>

                <!-- Sending data section container-->
                <div class="setNewContainer">
                    <!-- Component to input the text we want to add into the list -->
                    <vc-text class="addItem" name="addItem" type="text" placeholder="New Item"></vc-text>
                    
                    <!-- Button to add the text to the list. In the onclick we name the function to add the text. -->
                    <vc-button class="addButton" value="Add" expand="inline" onclick="addItem();"></vc-button>
                </div>
            </div>
    </div>
</div></textarea>

As you can see we have prepared a basic structure for our `To-Do List` and we have included a `scroll` component that will let us scroll through our list, we also have a `text` component so that the user can type any text that will be added to the list when our `button` component is triggered.

If you take a closer look you might find some `attributes` you have never seen before, these are `exclusive` for each type of components that will let us configure the behavior we want for the components, for instance, you can see that in the scroll element there are two attributes we are using, `thickness` and `fillContainer`; the value of `thickness` will determine the size of the scroll bars, while the value of `fillContainer` will tell the scroll if we want it to fill the size of its parent or it will have its own size.

 ## Dynamic components
 Once the static components are declared, we establish dynamic functionality in order to add the list items.

 The button for adding the new item will trigger the `addItem()` function, which will store the vc-text input value and send it to the `setValue()` function.
<textarea class="vCodeBlock" language="javascript">function addItem() {
    var textbox = document.querySelector("vc-text");
    var textboxValue = textbox.value;

    if (textboxValue != "") {
        // Call function to set the new list item
        setItem(textboxValue);

        // Reestablishes the vc-text value
        textbox.setValue("");
        textbox.value = "";
    }

}</textarea>

With this function we dinamically create the required components that will shape the list item. 
To use vComet programmatically we will do it inside the `onReady` event, ensure that all 
the functionalities are loaded in the document.
<textarea class="vCodeBlock" language="javascript">function setItem(newItem) {
    vcomet.onReady(function () {
        // We create a checkbox that will be the item in the list 
        var newCheckbox = document.createElement("vc-checkbox");
        // We add a button to edit the item
        var newEdit = document.createElement("vc-button");
        // We add a button to delete the item from the list
        var newDelete = document.createElement("vc-button");
        // newItemContainer is the node that will be contain the item
        var newItemContainer = document.createElement("div");
        var listContainer = document.querySelector(".listContainer");
        // This node will contain the default view of the item 
        var defaultContainer = document.createElement("div");

        // Set properties of checkbox item
        newCheckbox.classList.add("checkboxItem");
        newCheckbox.label = newItem;
        newCheckbox.value = newItem;

        // Edit item button
        newEdit.classList.add("editButton");
        newEdit.icon = '<i class="material-icons">mode_edit</i>';
        // Set the call to function to edit the value of the checkbox item
        newEdit.setOnClick("editItem(this.parentNode.parentNode);");

        // Delete item button properties
        newDelete.classList.add("deleteButton");
        newDelete.icon = '<i class="material-icons">close</i>';
        // Set the call to function to delete the node that contains the item
        newDelete.setOnClick("deleteItem(this.parentNode.parentNode);");

        // Inserts the newItemContainer to listContainer in the first position
        listContainer.insertBefore(newItemContainer, listContainer.children[0]);

        newItemContainer.classList.add("newItemContainer");
        // Append newCheckbox, newEdit and newDelete to newItemContainer 
        defaultContainer.appendChild(newCheckbox);
        defaultContainer.appendChild(newEdit);
        defaultContainer.appendChild(newDelete);

        newItemContainer.appendChild(defaultContainer);

        // Register newItemContainer node to be aware if it is on the click path by giving `isOnPath` property
        vcomet.registerPathListener(newItemContainer);
    });
}</textarea>

This function will create a `text` and `button` components so that the user can type the new value for the list item and accept the changes.
<textarea class="vCodeBlock" language="javascript">function editItem(item) {
    // Stores the item current value
    var itemValue = item.querySelector(".checkboxItem").value;

    item.classList.add("visibleEditor");

    // Editing node does not exist yet
    if (!item.querySelector(".editContainer")) {
        vcomet.onReady(function () {
            // We create a new input text to sent the new item value
            var newItemEdit = document.createElement("vc-text");
            var newSave = document.createElement("vc-button");
            // This node will contain the edit view of the item 
            var editContainer = document.createElement("div");

            editContainer.classList.add("editContainer");

            // Set input text properties
            newItemEdit.classList.add("editText");
            newItemEdit.placeholder = itemValue;

            // Save item button properties
            newSave.classList.add("saveButton");
            newSave.value = 'Save';
            // Call the function for establish the new item valie
            newSave.setOnClick("setEditItem(this.parentNode.parentNode);");

            //  Append newItemEdit and newSave to editContainer
            editContainer.appendChild(newItemEdit);
            editContainer.appendChild(newSave);

            // Append editContainer to the item wrapper
            item.appendChild(editContainer);

            // When you click outside the item, it loses focus and leaves the edit view 
            document.body.addEventListener("click", function (event) {
                // If the click event does not goes through this item the isOnPath property returns false
                if (item.isOnPath != true) {
                    item.classList.remove("visibleEditor");
                }
            }, false);
        });
    }
}</textarea>


</xmp>

<script>
// Onload launch strapdown
window.addEventListener('load', function(){
  var strapdown = document.createElement("script");
  strapdown.onload = function(){
    strapdownLoaded();
  };
  strapdown.src = "../../framework/strapdown/strapdown.js";
  document.head.appendChild(strapdown);
}, false );

// After strapdown parser launch perfectscrollbar and videojs
function strapdownLoaded() {
  // PerfectScrollbar
  var perfectScrollbarCss = document.createElement("link");
  perfectScrollbarCss.rel = "stylesheet";
  perfectScrollbarCss.href = "../../framework/perfectScrollbar/perfect-scrollbar.css";
  document.head.appendChild(perfectScrollbarCss);
  var perfectScrollbarJs = document.createElement("script");
  perfectScrollbarJs.onload = function(){
    perfectScrollbarLoaded();
  };
  perfectScrollbarJs.src = "../../framework/perfectScrollbar/perfect-scrollbar.js";
  document.head.appendChild(perfectScrollbarJs);

  // Video.js
  var videoCss = document.createElement("link");
  videoCss.rel = "stylesheet";
  videoCss.href = "../../framework/videoJS/videoJS.css";
  document.head.appendChild(videoCss);
  var videoIE = document.createElement("script");
  videoIE.src = "../../framework/videoJS/videoJSIE.js";
  document.head.appendChild(videoIE);
  var videoJs = document.createElement("script");
  videoJs.src = "../../framework/videoJS/videoJS.js";
  document.body.appendChild(videoJs);

  // FontAwesome
  var fontAwesome = document.createElement("link");
  fontAwesome.rel = "stylesheet";
  fontAwesome.href = "../../framework/fontAwesome/css/font-awesome.min.css";
  document.head.appendChild(fontAwesome);

  // CodeMirror
  var cMirrorCss = document.createElement("link");
  cMirrorCss.rel = "stylesheet";
  cMirrorCss.href = "../../framework/codeMirror/lib/codemirror.css";
  document.head.appendChild(cMirrorCss);
  var cMirrorTheme = document.createElement("link");
  cMirrorTheme.rel = "stylesheet";
  cMirrorTheme.href = "../../framework/codeMirror/theme/one-dark.css";
  document.head.appendChild(cMirrorTheme);
  var cMirrorJs = document.createElement("script");
  cMirrorJs.onload = function(){
    codeMirrorLoaded();
  };
  cMirrorJs.src = "../../framework/codeMirror/lib/codemirror.js";
  document.head.appendChild(cMirrorJs);

}

function perfectScrollbarLoaded(){
  var psMD = new PerfectScrollbar('#content');
}

function codeMirrorLoaded(){
  var cMirrorJsMode = document.createElement("script");
  cMirrorJsMode.onload = function(){
    var cMirrorCssMode = document.createElement("script");
    cMirrorCssMode.onload = function(){
      var cMirrorHtmlMode = document.createElement("script");
      cMirrorHtmlMode.onload = function(){
        var cMirrorXmlMode = document.createElement("script");
        cMirrorXmlMode.onload = function(){
          codeMirrorModeLoaded();
        };
        cMirrorXmlMode.src = "../../framework/codeMirror/mode/xml/xml.js";
        document.head.appendChild(cMirrorXmlMode);
      };
      cMirrorHtmlMode.src = "../../framework/codeMirror/mode/htmlmixed/htmlmixed.js";
      document.head.appendChild(cMirrorHtmlMode);
    };
    cMirrorCssMode.src = "../../framework/codeMirror/mode/css/css.js";
    document.head.appendChild(cMirrorCssMode);
  };
  cMirrorJsMode.src = "../../framework/codeMirror/mode/javascript/javascript.js";
  document.head.appendChild(cMirrorJsMode);
}

function codeMirrorModeLoaded(){
  var vGrounds = document.querySelectorAll(".vGround");
  vGrounds.forEach(function(vGs){
    var htmlCodeMirror = CodeMirror(function(elt) {
      var vGroundHtml = vGs.querySelectorAll(".vGroundContentHtml")[0];
      vGroundHtml.parentNode.replaceChild(elt, vGroundHtml);
    }, {value: vGs.querySelectorAll(".vGroundContentHtml")[0].value,
    mode: "htmlmixed",
    lineNumbers: true,
    readOnly:false,
    viewportMargin: Infinity,
    theme:"one-dark"
  });
  htmlCodeMirror.display.wrapper.classList.add("vGroundContent");
  htmlCodeMirror.display.wrapper.classList.add("vGroundContentHtml");


  var jsCodeMirror = CodeMirror(function(elt) {
    var vGroundJs = vGs.querySelectorAll(".vGroundContentJs")[0];
    vGroundJs.parentNode.replaceChild(elt, vGroundJs);
  }, {value: vGs.querySelectorAll(".vGroundContentJs")[0].value,
  mode: "javascript",
  lineNumbers: true,
  readOnly:false,
  viewportMargin: Infinity,
  theme:"one-dark"
});
jsCodeMirror.display.wrapper.classList.add("vGroundContent");
jsCodeMirror.display.wrapper.classList.add("vGroundContentJs");


var cssCodeMirror = CodeMirror(function(elt) {
  var vGroundCss = vGs.querySelectorAll(".vGroundContentCss")[0];
  vGroundCss.parentNode.replaceChild(elt, vGroundCss);
}, {value: vGs.querySelectorAll(".vGroundContentCss")[0].value,
mode: "css",
lineNumbers: true,
readOnly:false,
viewportMargin: Infinity,
theme:"one-dark"
});
cssCodeMirror.display.wrapper.classList.add("vGroundContent");
cssCodeMirror.display.wrapper.classList.add("vGroundContentCss");
});

// Initialize playgrounds
initializeIframes();

//Initialize codeBlocks
initCodeBlock();
}

function initCodeBlock(){
  var tidy = true;  //TODO get from md
  var indent = 2; //TODO get from md
  var vCodeBlocks = document.querySelectorAll(".vCodeBlock");
  vCodeBlocks.forEach(function(vCB){
    var cbLanguage = vCB.getAttribute("language") || "htmlmixed";
    if(cbLanguage === "html"){
      cbLanguage = "htmlmixed";
    }
    if(cbLanguage === "js"){
      cbLanguage = "javascript";
    }
    var codeBlockCM = CodeMirror(function(elt) {
      vCB.parentNode.replaceChild(elt, vCB);
    }, {value: vCB.value,
      readOnly:true,
      lineNumbers: true,
      mode: cbLanguage,
      viewportMargin: Infinity,
      theme:"one-dark"
    });
    codeBlockCM.display.wrapper.classList.add("vCodeBlock");
    if(tidy){
    //  codeBlockCM.autoFormatRange({line:0, ch:0}, {line:codeBlockCM.lineCount()});  //TODO no longer exists
    }
  });
}

function initializeIframes(){
  var iframes = document.querySelectorAll(".vGround");
  iframes.forEach(function(ifr){
    var ifrMenu = ifr.querySelector(".vGroundMenu");
    ifrMenu.querySelectorAll(".vGroundMenuButton").forEach(function(menuBtt){
      if(menuBtt.getAttribute("codeType") === "result"){
        vGroundResult(menuBtt);
      }
    });
  });
}

var SHOW_HEAD = "Show head";
var HIDE_HEAD = "Hide head";

function escapeRegExp(str) {
  return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&");
}
var headOpen = "<head>";
var headClose = "</head>";
var headRegex = new RegExp(
  escapeRegExp(headOpen) +
  "(?:(?!" +
  escapeRegExp(headOpen) +
  ")[\\s\\S])*" +
  escapeRegExp(headClose) +
  "(\\r\\n|\\r|\\n){0,1}",
  "g"
);

function vGroundHTML(node) {
  toggleShowHead(node, true);
  groundSetActive(node);
}

function vGroundJS(node) {
  toggleShowHead(node, false);
  groundSetActive(node);
}

function vGroundCSS(node) {
  toggleShowHead(node, false);
  groundSetActive(node);
}

function toggleShowHead(node, toggleTo) {
  var showHead = node.parentNode.querySelectorAll(".vGroundMenuShowHead")[0];
  if (toggleTo) {
    showHead.innerHTML = SHOW_HEAD;
    showHead.setAttribute("style", "display:block;");
  } else {
    showHead.setAttribute("style", "display:none;");
  }
}

function showHead(node) {
  htmlMirror = node.parentNode.parentNode.getElementsByClassName("vGroundContentHtml")[0];
  var htmlContent = htmlMirror.CodeMirror.getValue();
  if (node.innerHTML.toLowerCase().includes("show")) {
    var savedHead = htmlMirror.getAttribute("head");
    if (savedHead) {
      savedHead = decodeURIComponent(savedHead).trim() + "\n";
    } else {
      savedHead = "";
    }
    var fullContent = savedHead + htmlContent;
    htmlMirror.CodeMirror.setValue(fullContent);
    setTimeout(() => {
      htmlMirror.CodeMirror.refresh();
    }, 0);
    var showHead = node.parentNode.querySelectorAll(".vGroundMenuShowHead")[0];
    node.innerHTML = HIDE_HEAD;
  } else {
    htmlMirror.CodeMirror.setValue(htmlMirror.CodeMirror.getValue().replace(headRegex, ""));
    setTimeout(() => {
      htmlMirror.CodeMirror.refresh();
    }, 0);
    node.innerHTML = SHOW_HEAD;
  }
}

function vGroundResult(node) {
  toggleShowHead(node, false);
  groundSetActive(node);
  var vGroundContent = node.parentNode.parentNode.getElementsByClassName("vGroundContent")[0];
  var vGroundIframe = node.parentNode.parentNode.getElementsByClassName("vGroundIframe")[0];
  var iframeContent = vGroundIframe.contentWindow.document || vGroundIframe.contentDocument;

  var htmlContent = getHtml(node);

  var iframeSrc = "<!DOCTYPE html><html><head>";
  iframeSrc += getCss(node).outerHTML;

  if (htmlContent.head && htmlContent.head != "") {
    iframeSrc += htmlContent.head;
  } else {
    var commonHead = "";
    htmlMirror = node.parentNode.parentNode.getElementsByClassName("vGroundContentHtml")[0];
    var savedHead = htmlMirror.getAttribute("head");

    if (savedHead) {
      commonHead = decodeURIComponent(savedHead);
    }
    iframeSrc += commonHead.replace(new RegExp("<head>", "g"), "").replace(new RegExp("<\/head>", "g"), "");
  }
  iframeSrc += "</head><body>" + htmlContent.body;

  iframeSrc += getJs(node).outerHTML;

  iframeSrc += "</body></html>";
  
  iframeContent.open();
  iframeContent.write(iframeSrc);
  iframeContent.close();
}

fragmentFromString = function (str) {
  // Test createContextualFragment support
  if (!("__supportsContextualFragment" in window)) {
    try {
      document.createRange().createContextualFragment("test");
      window.__supportsContextualFragment = true;
    } catch (error) {
      window.__supportsContextualFragment = false;
    }
  }
  if (window.__supportsContextualFragment) {
    return document.createRange().createContextualFragment(str);
  } else {
    var temp = document.createElement("template");
    temp.innerHTML = str;
    return temp.content;
  }
};

function getCss(node) {
  var cssContent = node.parentNode.parentNode.getElementsByClassName("vGroundContentCss")[0].CodeMirror.getValue();
  var cssSheet = document.createElement("style");
  cssSheet.rel = "stylesheet";
  cssSheet.innerHTML = cssContent;
  return cssSheet;
}

function getJs(node) {
  var jsContent = node.parentNode.parentNode.getElementsByClassName("vGroundContentJs")[0].CodeMirror.getValue();
  var jsScript = document.createElement("script");
  jsScript.innerHTML = jsContent;
  return jsScript;
}

function getHtml(node) {
  var result = {};
  result.head = "";
  result.body = "";
  var headFound = false;
  var bodyFound = false;
  var htmlContent = node.parentNode.parentNode.getElementsByClassName("vGroundContentHtml")[0].CodeMirror.getValue();
  var headResult = "";
  var headMatches = htmlContent.match(headRegex);
  if (headMatches) {
    headFound = true;
    result.head = cleanMatch(headMatches[0], headOpen, headClose);
  } else {
    if (!node.parentNode.parentNode.getElementsByClassName("vGroundContentHtml")[0].getAttribute("head")) {
      
    }
  }

  var bodyOpen = "<body>";
  var bodyClose = "</body>";
  var bodyRegex = new RegExp(
    escapeRegExp(bodyOpen) +
    "(?:(?!" +
    escapeRegExp(bodyOpen) +
    ")[\\s\\S])*" +
    escapeRegExp(bodyClose) +
    "(\\r\\n|\\r|\\n){0,1}",
    "g"
  );
  var bodyResult = "";
  var bodyMatches = htmlContent.match(bodyRegex);
  if (bodyMatches) {
    bodyFound = true;
    result.body = cleanMatch(bodyMatches[0], bodyOpen, bodyClose);
  }
  if (!headFound && !bodyFound) {
    result.body = htmlContent;
  } else if (headFound && !bodyFound) {
    result.body = htmlContent.replace(headRegex, "");
  }
  return result;
}


function groundSetActive(node) {
  var vGroundContent = node.parentNode.parentNode.getElementsByClassName("vGroundContent");
  var vGroundIframe = node.parentNode.parentNode.getElementsByClassName("vGroundIframe")[0];
  Array.prototype.forEach.call(vGroundContent, function (vGC) {
    vGC.setAttribute("style", "display:none;");
  });
  vGroundIframe.setAttribute("style", "display:none;");
  var codeType = node.getAttribute("codeType");
  switch (codeType) {
    case "result":
      vGroundIframe.setAttribute("style", "display:block;");
      break;
    case "html":
      vGroundContent = node.parentNode.parentNode.getElementsByClassName("vGroundContentHtml")[0];
      var htmlContent = vGroundContent.CodeMirror.getValue();
      var headMatch = htmlContent.match(headRegex);
      if (headMatch) {
        var headContent = headMatch[0];
        vGroundContent.setAttribute("head", encodeURIComponent(headContent));
        htmlContent = htmlContent.replace(headRegex, "");
        vGroundContent.CodeMirror.setValue(htmlContent);
        setTimeout(() => {
          vGroundContent.CodeMirror.refresh();
        }, 0);
      } else {
        if (!vGroundContent.getAttribute("head")) {
          var cHead = null;
          
          if (cHead) {
            vGroundContent.setAttribute("head", encodeURIComponent(cHead));
          }
        }
      }
      vGroundContent.setAttribute("style", "display:block;");
      break;
    case "js":
      vGroundContent = node.parentNode.parentNode.getElementsByClassName("vGroundContentJs")[0];
      vGroundContent.setAttribute("style", "display:block;");
      break;
    case "css":
      vGroundContent = node.parentNode.parentNode.getElementsByClassName("vGroundContentCss")[0];
      vGroundContent.setAttribute("style", "display:block;");
      break;
    default:

  }
  var sibligns = node.parentNode.childNodes;
  sibligns.forEach(function (sibl) {
    sibl.classList.remove("vGroundMenuActive");
  });
  node.classList.add("vGroundMenuActive");
}



function cleanMatch(match, open, close) {
  match = match.trim();
  match = match.substring(open.length, match.length - close.length).trim();
  return match;
}
</script>



</html>
