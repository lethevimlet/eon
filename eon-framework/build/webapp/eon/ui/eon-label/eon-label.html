<template>

  <div class="eon-label-data eon-fg2">
    <label class="eon-label-label"></label>
  </div>

  <div class="eon-label-main eon-fg2">

    <div class="eon-label-default">
        <div class="eon-label-value"></div>
        <div class="eon-label-button vicon vicon-edit"></div>
    </div>

    <div class="eon-label-edit">
        <div class="eon-label-inputWrapper">
            <input class="eon-label-input eon-fg2"></input>
        </div>
        <div class="eon-label-button vicon vicon-ok"></div>
    </div>
    
  </div>

  <span class="eon-label-underline"></span>

</template>

<script type="text/javascript">
  eon.element("eon-label", "eon-label.css", {

    privateProperties: {
      /*
      @property (private) {Object} _misc
      @description Object with useful information
      */
      misc: {
        value: {},
        reflect: false
      },
      /*
      @property (private) {Object} _refs
      @description Object with references to frecuently queryied nodes
      */
      refs: {
        value: {},
        reflect: false
      }
    },

    properties: {
      /*
      @property {Boolean} inline 
      @description Space that occupies the button inside its parent container.
      */
      inline: {
        value: true,
        reflect: true,
        reflectDefault: true
      },
      /*
      @property {String} label
      @description Label for the element
      */
      label: {
        value: "",
        reflect: true,
        reflectDefault: true
      },
      /*
      @property {Number} fontSize
      @description Font size specified by the user
      */
      fontSize: {
          value: "",
          reflect: true
      },
      /*
      @property {String} value
      @description Value of the element
      */
      value: {
          value: "",
          reflect: true
      }
    },

    privateFunctions: {

      /*
      @function (private) _setupRefs
      @description Creates references for relevant nodes
      */
      setupRefs: function () {

        var el = this;

        el._refs.data = el.querySelector(".eon-label-data");
        el._refs.label = el.querySelector(".eon-label-label");

        el._refs.main = el.querySelector(".eon-label-main");

        el._refs.default = el.querySelector(".eon-label-default");
        el._refs.edit = el.querySelector(".eon-label-edit");

        el._refs.value = el.querySelector(".eon-label-value");
        el._refs.input = el.querySelector(".eon-label-input");

        el._refs.editButton = el.querySelector(".eon-label-default .eon-label-button");
        el._refs.saveButton = el.querySelector(".eon-label-edit .eon-label-button");

      },

      setupLabel: function () {
        
        var el = this;
        
        if (el.label) {
          el._refs.label.innerHTML = el.label;
        }

      },

      setupFontSize: function () {
        
        var el = this;

        if (el.fontSize) {
          el._refs.value.style.fontSize = el.fontSize;
          el._refs.input.style.fontSize = el.fontSize;
        }

      },

      setupInput: function () {
        
        var el = this;

        el._refs.input.addEventListener("focus", function () {
          el.classList.add("eon-label-focus");
        });

        el._refs.input.addEventListener("blur", function () {
          el.classList.remove("vc-label-focus");
        });

      },

      setupEditing: function () {

        var el = this;

        el._refs.editButton.addEventListener("click", function () {
          el._startEditing();
        });

        el._refs.saveButton.addEventListener("click", function () {
          el._finishEditing();
        });

      },

      startEditing: function () {

        var el = this;

        // el.dataset.editing = true;
        
        el._refs.input.value = el._refs.value.innerText;
        el._refs.input.focus();

        el._refs.main.classList.add("eon-label-editing", "eon-bg2");

        setTimeout(function () {
          el.classList.add("eon-label-focus");
        }, 0);

      },

      finishEditing: function () {

        var el = this;

        el._refs.value.innerHTML = el._refs.input.value;

        el._refs.input.blur();
        el._refs.main.classList.remove("eon-label-editing", "eon-bg2", "vc-label-focus");

        el._updateValue(el._refs.input.value);

      },

      updateValue: function (value) {
       
        var el = this;

        value = value ? value : el.value;

        el._refs.value.innerHTML = value;
        el._refs.input.value = value;

        el.__value = value;

      }

    },

    functions: {



    },

    onRender: function () {

      var el = this;

      el._setupRefs();
      el._setupLabel();
      el._setupFontSize();
      el._setupInput();
      el._setupEditing();

      el._updateValue();

    }

  });
</script>