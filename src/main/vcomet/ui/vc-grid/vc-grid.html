<template>

    <div class="vc-grid-header">
        <div class="vc-grid-wrapper vc-sect1"></div>
    </div>

    <div class="vc-grid-rows">
        <vc-scroll thickness="10" rail-scrolls="false">
            <div class="vc-grid-wrapper">
            </div>
        </vc-scroll>
    </div>

    <div class="vc-grid-footer vc-fg1 vc-sect1 vc-unselectable">
        <div class="vc-grid-pagControls vc-fg5">
            <i class="vicon vicon-arrow-back vc-grid-pagIcon vc-fg1-hoverable" data-navigation="first"></i>
            <i class="vicon vicon-chevron-left vc-grid-pagIcon vc-fg1-hoverable" data-navigation="previous"></i>
            <div class="pageSelector"></div>
            <i class="vicon vicon-chevron-right vc-grid-pagIcon vc-fg1-hoverable" data-navigation="next"></i>
            <i class="vicon vicon-arrow-forward vc-grid-pagIcon vc-fg1-hoverable" data-navigation="last"></i>
        </div>
        <span class="vc-grid-entriesCount vc-fg5"></span>
    </div>

</template>

<script type="text/javascript">
    vcomet.element("vc-grid", "vc-grid.css", {
        themed: true,
        dependencies: [
            "../vc-row",
            "../vc-cell",
            "../vc-scroll"
        ],
        privateProperties: {
            /*
            @property (private) {Object} _misc
            @description Object with miscellaneous data
            */
            misc: {
                value: {},
                reflect: false
            },
            /*
            @property (private) {Object} _refs
            @description Object with references
            */
            refs: {
                value: {},
                reflect: false
            },
        },

        properties: {
            /*
            @property {Boolean} footer
            @description Whether the footer will be displayed or not
            */
            footer: {
                value: true,
                reflect: true
            },
            /*
            @property {String} pagination
            @description Defines the type of the page pagination
            */
            pagination: {
                value: "",
                reflect: true
            },
            /*
            @property {Boolean} entriesCount
            @description Whether the footer will display the page entries or not
            */
            entriesCount: {
                value: false,
                reflect: true
            },
            /*
            @property {String} columns
            @description Defines the columns that will be shown in the grid
            */
            columns: {
                value: "",
                reflect: true
            },
            /*
            @property {String} headers
            @description Defines the headers of the given columns
            */
            headers: {
                value: "",
                reflect: true
            },
            /*
            @property {String} String
            @description It can be a number of max rows of the page, or automatic
            */
            pageSize: {
                value: "auto",
                reflect: true
            },
            /*
            @property {Boolean} autofit
            @description Whether the grid will manage the rows amount depending on the available space
            */
            autofit: {
                value: "true",
                reflect: true
            },
            /*
            @property {Boolean} resizable
            @description Whether the user can resize the columns or not
            */
            resizable: {
                value: true,
                reflect: true
            },
            /*
            @property {Number} columnMinWidth
            @description Pixels that will be set as the minimum width of each column
            */
            columnMinWidth: {
                value: 150,
                reflect: true
            },
            /*
            @property {Number} rowMinHeight
            @description Pixels that will be set as the minimum height of each row
            */
            rowMinHeight: {
                value: 52,
                reflect: true
            },
            /*
            @property {Boolean} editable
            @description Whether the user will be able to edit entry cells or not
            */
            editable: {
                value: "false",
                reflect: true
            },
            /*
            @property {String} idProperty
            @description This property will be transfered to the store
            */
            idProperty: {
                value: "",
                reflect: true
            },
            /*
              @property {Boolean} fill 
              @description 
              Values: true, false
              Default: true
            */
            fill: {
                value: true,
                reflect: true
            }
        },

        privateFunctions: {
            /*
            @function (private) _setupRefs
            @description Creates some fast access elements so that theres no need for calling the QuerySelector all the time.
            */
            setupRefs: function () {

                var el = this;

                el._refs.header = el.template.querySelector(".vc-grid-header");
                el._refs.headersWrapper = el.template.querySelector(".vc-grid-header .vc-grid-wrapper");
                el._refs.rowsWrapper = el.template.querySelector(".vc-grid-rows .vc-grid-wrapper");
                el._refs.footer = el.template.querySelector(".vc-grid-footer");

                el._refs.scroll = el.template.querySelector("vc-scroll");

                el._refs.pageSelector = el.template.querySelector(".pageSelector");
                el._refs.entriesCount = el.template.querySelector(".vc-grid-entriesCount");

            },
            /*
            @function (private) _setupMisc
            @description Sets up basic properties for the misc object
            */
            setupMisc: function () {

                var el = this;

                el._misc.columns = {};
                el._misc.range = {};
                el._misc.entriesCount = 0;

                el._misc.resize = {};
                el._misc.resize.active = false;
                el._misc.resize.firstTime = true;

                el._misc.sourceFragment = document.createDocumentFragment();
                el._misc.sourceType = "";

                el._misc.currentPage = 1;
                el._misc.hasPagination = true;
                el._misc.isEditing = false;

            },
            /*
            @function (private) _generateSourceFragment
            @description Takes all the source declared by the user and creates its own fragment to save it
            */
            generateSourceFragment: function () {
                this._misc.sourceFragment.appendChild(this.source);
            },
            /*
            @function (private) _defineDataSourceType
            @description Depending on what the user provided with the grid we will define the type of source we will use to fill our grid
            */
            defineDataSourceType: function () {

                var el = this;

                var store = this._misc.sourceFragment.querySelector("vc-store");
                var rows = this._misc.sourceFragment.querySelectorAll("vc-row");

                if (store) {

                    el._misc.sourceType = "remote";
                    el.appendChild(store);

                } else if (rows) {

                    el._misc.sourceType = "declarative";

                }

            },
            /*
            @function (private) _setupStore
            @description Sets up callbacks to be called when this data is loaded and updated
            */
            setupStore: function () {

                var el = this;

                var start = 1;
                var limit = parseInt(el.pageSize);

                // var myCallback = function () {

                //     if (el._misc.pageSizeType == "all") {
                //         el.pageSize = el.store.size;
                //     }

                //     el._handleStoreEntries("object", true, start, limit);
                //     el._updatePagination(1);

                // };

                //Store calls
                el.store.onCreated(function () {

                    el.store.onLoaded(function () {
                        el.store.listRemote(myCallback);
                    });

                    el.store.onSourceChanged(myCallback);

                });

            },
            /*
            @function (private) _updatePaged
            @description Updates pageSelectors and the navigability buttons
            @param {Number} page
            */
            updatePagination: function (page) {

                var el = this;

                el._misc.currentPage = page;

                if (el._misc.hasPagination) {

                    if (el.pagination == "strip") el._createPagesForPagesStrip();

                    el._updatePageSelector(page);
                    el._handleNavigability();

                }

            },
        },

        onCreated: function () {

            var el = this;

            el._setupRefs();
            el._setupMisc();
            el._generateSourceFragment();

            vcomet.createCallback("onCellCreated", el);
            vcomet.createCallback("onRowCreated", el);
            vcomet.createCallback("onEdit", el);

        },
        onInit: function () {

            var el = this;

            // ** Apply default items positioning style
            el._setDefaultStyle();

        },

        onBubbleRender: function () {

            var el = this;

            el.classList.add("vc-bg1", "vc-boxshadow1");

        }
    });

</script>