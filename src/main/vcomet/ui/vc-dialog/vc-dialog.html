<template>
    <div class="vc-dialog-dialog vc-bg1 vc-fg1 vc-boxshadow1 vc-defaultStyle">
        <div class="vc-dialog-heading vc-sect1 vc-unselectable">
            <div class="vc-dialog-headingButtons">
                <i class="vc-dialog-minimize vc-fg1-hoverable vc-dialog-hidden vicon vicon-minimize"></i>
                <i class="vc-dialog-maximize vc-fg1-hoverable vc-dialog-hidden vicon vicon-maximize"></i>
                <i class="vc-dialog-close vc-fg1-hoverable vicon vicon-close"></i>
            </div>
        </div>
        <vc-scroll arrowScrolls="true" thickness="10" fill-container="true" fit="true">
        </vc-scroll>
    </div>
</template>

<script type="text/javascript">
    vcomet.element("vc-dialog", "vc-dialog.css", {
        dependencies: [
            "../vc-section",
            "../vc-scroll"
        ],
        properties: {
            /*
              @property {String} heading 
              @description Dialog title
            */
            heading: {
                value: "",
                reflect: true
            },
            /*
              @property {Boolean} closable 
              @description Dialog may have a button that will close it
              Values can be: true or false
              Default: true
            */
            closable: {
                value: "true",
                reflect: true
            },
            /*
              @property {Boolean} blur 
              @description Dialog is closed when click outside it
              Values can be: true or false
              Default: false
            */
            blur: {
                value: "false",
                reflect: true
            },
            /*
              @property {Boolean} modal 
              @description Allow page components inaccessible until interact with dialog
              Values can be: true or false
              Default: false
            */
            modal: {
                value: "false",
                reflect: true
            },
            /*
              @property {Boolean} drag 
              @description Dialog draggable
              Values can be: true or false
              Default: false
            */
            drag: {
                value: "false",
                reflect: true
            },
            /*
              @property {Boolean} resize 
              @description Dialog resizable
              Values can be: true or false
              Default: false
            */
            resize: {
                value: "false",
                reflect: true
            },
            /*
              @property {Boolean} maximize 
              @description Dialog maximizable
              Values can be: true or false
              Default: false
            */
            maximize: {
                value: "false",
                reflect: true
            },
            /*
              @property {Boolean} minimize 
              @description Dialog minimizable
              Values can be: true or false
              Default: false
            */
            minimize: {
                value: "false",
                reflect: true
            },
            /*
              @property {String} multiposition 
              @description Position of more than one open dialogs
              Values can be: centered or scaled
              Default: centered
            */
            multiposition: {
                value: "centered",
                reflect: true
            },
            /*
              @property {String} maxWidth 
              @description Dialog maximum width
              Values can be: auto or number
              Default: auto
            */
            maxWidth: {
                value: "auto",
                reflect: true
            },
            /*
              @property {Number} maxHeight 
              @description Dialog maximum height
              Value must be int number 
              Default: 500
            */
            maxHeight: {
                value: "500",
                reflect: true
            },
            /*
              @property {Number} minWidth 
              @description Dialog minimum width
              Value must be int number 
              Default: 250
            */
            minWidth: {
                value: "250",
                reflect: true
            },
            /*
              @property {Number} minHeight 
              @description Dialog minimum height
              Value must be int number 
              Default: 200
            */
            minHeight: {
                value: "200",
                reflect: true
            },
            /*
              @property {Number} scaleBreak 
              @description Distance in pixels between scaled dialogs
              Value must be int number 
              Default: 20
            */
            scaleBreak: {
                value: "20",
                reflect: true
            },
            /*
              @property {Boolean} hasFooter 
              @description Makes the dialog footer visible or not
              Default: false
            */
            hasFooter: {
                value: "false",
                reflect: true
            },
            /*
              @property {Boolean} allowScroll
              @description Allow or denied scroll
            */
            allowScroll: {
                value: true,
                reflect: true
            },
            /*
             @property {Object} content 
             @description Reference to the content element
           */
            window: {
                value: {}
            },
            /*
             @property {Object} content 
             @description Reference to the content element
           */
            content: {
                value: {}
            },
            /*
             @property {Object} footer 
             @description Reference to the footer element
           */
            footer: {
                value: {}
            },
            /*
              @property {Boolean} defaultStyle 
              @description 
              Values: true, false
              Default: true
            */
            defaultStyle: {
                value: true,
                reflect: true
            }
        },
        privateProperties: {
            /*
              @property (private) {Object} _misc 
              @description Stores dialog useful data.
            */
            misc: {
                value: {}
            },
            /*
              @property (private) {Object} _refs 
              @description Object with  references
            */
            refs: {
                value: {}
            },
        },

        privateFunctions: {
            /*
              @function (private) _createRefs
              @description Creates fast access to elements
            */
            createRefs: function () {
                var el = this;

                el._refs.dialog = el.template.querySelector(".vc-dialog-dialog");
                el._refs.heading = el.template.querySelector(".vc-dialog-heading");
                el._refs.footer = el.template.querySelector(".vc-dialog-footer");
                el._refs.buttonsFooter = el.template.querySelector(".vc-dialog-buttonsFooter");
                el._refs.close = el.template.querySelector(".vc-dialog-close");
                el._refs.scroll = el.template.querySelector("vc-scroll");

                el._refs.maximizeButton = el.template.querySelector(".vc-dialog-maximize");
                el._refs.minimizeButton = el.template.querySelector(".vc-dialog-minimize");

                el._refs.userContent = el.source.querySelector("[type='content']");
                el._refs.userFooter = el.source.querySelector("[type='footer']");

                // Public window reference
                el.window = el._refs.dialog;
            },

            /*
              @function (private) _handleContentScroll
              @description Depending on the allowScroll property we append the user content to the custom scroll or not
            */
            handleContentScroll: function () {
                var el = this;

                if (vcomet.util.isTrue(el.allowScroll)) {
                    el._refs.scroll.appendChild(el.content);
                } else {
                    el.content.style.overflow = "auto";
                    el._refs.dialog.appendChild(el.content);
                    el._refs.scroll.parentNode.removeChild(el._refs.scroll);
                }
            },
            /*
              @function (private) _setDefaultStyle
              @description Check if the default element style should be applied
            */
            setDefaultStyle: function () {
                var el = this;
                // Check default style configuration
                if (!vcomet.util.isTrue(el.defaultStyle)) {
                    // Remove default style
                    el._refs.dialog.classList.remove("vc-spaced-container");
                    el._refs.dialog.classList.remove("vc-defaultStyle");
                    el._refs.userContent.classList.remove("vc-spaced-container");
                } else {
                    // Spaced items container
                    var spacedItemsContainer = document.createElement("div");
                    var spacedFragment = document.createDocumentFragment();
                    spacedItemsContainer.classList.add("vc-spaced-items-container");
                    // Append content into the new spaced items container
                    var nodes = [].slice.call(el._refs.userContent.childNodes);
                    while (nodes.length) {
                        spacedFragment.appendChild(nodes.shift());
                    }
                    spacedItemsContainer.appendChild(spacedFragment);
                    el._refs.userContent.appendChild(spacedItemsContainer);
                }
            },
            /*
              @function (private) _addHeading
              @description Add dialog heading and its different options
            */
            addHeading: function () {
                var el = this;
                vcomet.registerPathListener(el._refs.close);

                // If the user specified a heading title or he did not but he set closable to true
                // we want to enable the header with the closable button
                if (el.heading != "" || el.heading == "" && vcomet.util.isTrue(el.closable)) {
                    el._refs.heading.classList.remove("vc-dialog-hidden");

                    if (el._refs.dialog.querySelector(".vc-dialog-title")) {
                        el._refs.dialog.querySelector(".vc-dialog-title").innerHTML = el.heading;

                    } else {
                        var title = document.createElement("span");
                        title.classList.add("vc-dialog-title");
                        title.innerHTML = el.heading;
                        // As we want the heading to be at the top of the dialog, we insert it before its first child
                        el._refs.heading.insertBefore(title, el._refs.heading.childNodes[0]);
                    }

                    // If closable is enabled then we add its event listener to close the dialog
                    if (vcomet.util.isTrue(el.closable)) {
                        el._refs.close.addEventListener("click", function () {
                            el.close();
                        });
                        // Otherwise we just hide the button
                    } else {
                        el._refs.close.classList.add("vc-dialog-hidden");
                    }


                } else {
                    el._refs.close.classList.add("vc-dialog-hidden");
                    el._refs.heading.classList.add("vc-dialog-hidden");
                }

            },

            /*
              @function (private) _addContent
              @description Adds dialog content
            */
            addContent: function () {
                var el = this;

                el._refs.userContent = el._refs.userContent ? el._refs.userContent : document.createElement("vc-section");

                el._refs.userContent.type = "content";
                el._refs.userContent.classList.add("vc-dialog-content", "vc-spaced-container");

                el.content = el._refs.userContent;
            },

            /* 
              @function (private) _addFooter
              @description Adds dialog footer
            */
            addFooter: function () {
                var el = this;

                el.footer = el._refs.userFooter ? el._refs.userFooter : document.createElement("vc-section");
                el.footer.type = "footer";
                el.footer.classList.add("vc-dialog-footer", "vc-spaced-items-container", "vc-sect1", "vc-unselectable");

                el._handleFooterAppend();
            },

            /* 
              @function (private) _handleFooterAppend
              @description Depending on the hasFooter property it will append/remove the footer from the dialog
            */
            handleFooterAppend: function () {
                var el = this;

                el.onInit(function () {
                    if (vcomet.util.isTrue(el.hasFooter)) {
                        el._refs.dialog.appendChild(el.footer);
                    } else {
                        if (el.footer.parentNode && el.footer.parentNode.isEqualNode(el._refs.dialog)) {
                            el._refs.dialog.removeChild(el.footer);
                        }
                    }
                });

            },

            /*
              @function (private) _addBlurEvent
              @description Adds listener that give blur functionality to dialog
            */
            addBlurEvent: function () {
                var el = this;

                if (vcomet.util.isTrue(el.blur)) {
                    vcomet.registerPathListener(el._refs.dialog);

                    // This fixes click not being triggered on body on iPad
                    if (/iPad|iPhone/.test(navigator.platform)) {
                        document.body.style.cursor = "pointer";
                    }

                    document.body.addEventListener("pointerdown", function (e) {

                        if (el._refs.dialog.classList.contains("vc-dialog-visible") && el._refs.dialog.isOnPath == false) {
                            el.close();
                        }
                    }, false);
                }
            },
            /*
            @function (private) _addDragListeners
            @description Adds drag listeners
            */
            addDragListeners: function () {
                var el = this;

                if (vcomet.util.isTrue(el.drag) && el._refs.dialog.dataset.version == "desktop") {
                    var xPos = 0;
                    var yPos = 0; // Stores x & y coordinates of the mouse pointer
                    var xElem = 0;
                    var yElem = 0; // Stores top, left values (edge) of the element
                    var windowWidth;
                    var windowHeight;

                    // Will be called when user starts dragging an element
                    el._refs.heading.addEventListener("mousedown", function (e) {
                        if (e.button == 0 && !el._refs.heading.classList.contains("vc-dialog-hidden") && el._refs.close.isOnPath == false) {
                            // Store the object of the element which needs to be moved
                            el._misc.drag.started = true;
                            xElem = xPos - el._refs.dialog.offsetLeft;
                            yElem = yPos - el._refs.dialog.offsetTop;
                        }

                    });

                    window.addEventListener("mousemove", function (e) {
                        xPos = e.pageX;
                        yPos = e.pageY;

                        if (el._misc.drag.started && el.dataset.status == "") {
                            if (el._refs.dialog.style.width == "" && el._refs.dialog.classList.contains("vc-dialog-visible")) {
                                el._refs.dialog.style.width = el._refs.dialog.offsetWidth + "px";
                                el._refs.dialog.style.height = el._refs.dialog.offsetHeight + "px";
                            }
                            el._refs.dialog.style.left = (xPos - xElem) + "px";
                            el._refs.dialog.style.top = (yPos - yElem) + "px";

                            // Call method to establish movement of dialog limits
                            el._dragLimits();
                            el._refs.dialog.classList.remove("vc-dialog-scaled");
                            el._misc.centered = false;
                        }

                    }, false);

                    window.addEventListener("mouseup", function (e) {
                        el._misc.drag.started = false;
                    }, false);

                }
            },

            /*
              @function (private) _addDragListeners
              @description Establish limits for dialog movement
            */
            dragLimits: function () {
                var el = this;
                windowWidth = window.innerWidth - el._misc.windowPadding;
                windowHeight = window.innerHeight - el._misc.windowPadding;

                el._refs.dialog.style.left = (el._refs.dialog.offsetLeft < el._misc.windowPadding) ? el._refs.dialog.style.left = el._misc.windowPadding + "px" : el._refs.dialog.style.left;
                el._refs.dialog.style.top = (el._refs.dialog.offsetTop < el._misc.windowPadding) ? el._refs.dialog.style.top = el._misc.windowPadding + "px" : el._refs.dialog.style.top;

                el._refs.dialog.style.left = ((el._refs.dialog.offsetLeft + el._refs.dialog.offsetWidth) > windowWidth) ? windowWidth - el._refs.dialog.offsetWidth + "px" : el._refs.dialog.style.left;
                el._refs.dialog.style.top = ((el._refs.dialog.offsetTop + el._refs.dialog.offsetHeight) > windowHeight) ? windowHeight - el._refs.dialog.offsetHeight + "px" : el._refs.dialog.style.top;
            },

            /*
              @function (private) _addResizes
              @description Adds resizes and their functionality.
            */
            addResizes: function () {
                var el = this;

                // When the dialog changes its size dynamically it will center
                vcomet.addResizeListener(el._refs.dialog, "dialog", function () {
                    if (el._refs.dialog.classList.contains("vc-dialog-visible") && el.multiposition == "centered" && !el._misc.resize.active && el._misc.previousWindowWidth == el._misc.newWindowWidth) {
                        el._center();
                    }
                });

                if (vcomet.util.isTrue(el.resize) && el._refs.dialog.dataset.version == "desktop") {
                    var sideResizers = ["top", "right", "bottom", "left"];
                    var cornerResizers = ["topLeft", "topRight", "bottomLeft", "bottomRight"];
                    var sideResizersClasses = ["vc-dialog-topResizer", "vc-dialog-rightResizer", "vc-dialog-bottomResizer", "vc-dialog-leftResizer"];
                    var cornerResizersClasses = ["vc-dialog-topLeftResizer", "vc-dialog-topRightResizer", "vc-dialog-bottomLeftResizer", "vc-dialog-bottomRightResizer"];

                    el._refs.resizers = {};
                    el._refs.resizers.sides = {};
                    el._refs.resizers.corners = {};

                    for (var i = 0; i < sideResizers.length; i++) {
                        el._refs.resizers.sides[sideResizers[i]] = document.createElement("div");
                        el._refs.resizers.sides[sideResizers[i]].classList.add(sideResizersClasses[i], "vc-dialog-sideResizer");
                        el._addResizeListeners("sides", sideResizers[i]);
                        el._refs.dialog.appendChild(el._refs.resizers.sides[sideResizers[i]]);
                    }

                    for (var i = 0; i < cornerResizers.length; i++) {
                        el._refs.resizers.corners[cornerResizers[i]] = document.createElement("div");
                        el._refs.resizers.corners[cornerResizers[i]].classList.add(cornerResizersClasses[i], "vc-dialog-cornerResizer");
                        el._addResizeListeners("corners", cornerResizers[i]);
                        el._refs.dialog.appendChild(el._refs.resizers.corners[cornerResizers[i]]);
                    }
                }

            },

            /*
              @function (private) _addResizeListeners
              @description Adds resize listeners
              @param {String} type [Type of resizer, side or corner]
              @param {String} resizerName 
            */
            addResizeListeners: function (type, resizerName) {
                var el = this;
                var moveFunctionName = type == "sides" ? "_handleSideResize" : "_handleCornerResize";

                var moveFunction = function (e) {
                    el[moveFunctionName](resizerName, e);
                    // Sets centered to false so that when the window is resized it does not center it
                    el._misc.centered = false;
                    // Removes the scaled class so that when the window is resized it does not moves the dialog to its new according scaled position
                    el._refs.dialog.classList.remove("vc-dialog-scaled");
                };

                el._refs.resizers[type][resizerName].addEventListener("mousedown", function (e) {
                    el._misc.resize.active = true;
                    el._misc.resize.startX = e.clientX;
                    el._misc.resize.startY = e.clientY;
                    el._misc.resize.startWidth = parseInt(document.defaultView.getComputedStyle(el._refs.dialog).width, 10);
                    el._misc.resize.startHeight = parseInt(document.defaultView.getComputedStyle(el._refs.dialog).height, 10);

                    el._refs.dialog.classList.add("vc-unselectable");
                    document.body.addEventListener("mousemove", moveFunction);
                });

                document.addEventListener("mouseup", function (e) {
                    el._misc.resize.active = false;
                    el._refs.dialog.classList.remove("vc-unselectable");
                    document.body.removeEventListener("mousemove", moveFunction);
                });

            },
            /*
              @function (private) _handleSideResize
              @description Handle sides resize functionality
              @param {String} resizerName [Resizer name]
              @param {Object} e [Mouse event]
            */
            handleSideResize: function (resizerName, e) {
                var el = this;
                var rightLimit = window.innerWidth - el._misc.windowPadding;
                var bottomLimit = window.innerHeight - el._misc.windowPadding;
                var newWidth, newHeight;

                switch (resizerName) {
                    case "left":
                        newWidth = (el._misc.resize.startWidth + el._misc.resize.startX - e.clientX);
                        if (e.clientX >= el._misc.windowPadding) {
                            newWidth = el._getAdjustedWidth(newWidth);
                            if (newWidth != el.maxWidth && newWidth != el.minWidth) {
                                el._refs.dialog.style.left = e.clientX + "px";
                                el._refs.dialog.style.width = newWidth + "px";
                            }
                        }
                        break;

                    case "right":
                        newWidth = (el._misc.resize.startWidth + e.clientX - el._misc.resize.startX);
                        if (e.clientX <= rightLimit) {
                            newWidth = el._getAdjustedWidth(newWidth);
                            el._refs.dialog.style.width = newWidth + "px";
                        }
                        break;

                    case "top":
                        newHeight = (el._misc.resize.startHeight + el._misc.resize.startY - e.clientY);
                        if (e.clientY >= el._misc.windowPadding) {
                            newHeight = el._getAdjustedHeight(newHeight);
                            if (newHeight != el.maxHeight && newHeight != el.minHeight) {
                                el._refs.dialog.style.top = e.clientY + "px";
                                el._refs.dialog.style.height = newHeight + "px";
                            }
                        }
                        break;

                    case "bottom":
                        newHeight = (el._misc.resize.startHeight + e.clientY - el._misc.resize.startY);
                        if (e.clientY <= bottomLimit) {
                            newHeight = el._getAdjustedHeight(newHeight);
                            el._refs.dialog.style.height = newHeight + "px";
                        }
                        break;
                    default:

                }


            },
            /*
              @function (private) _handleCornerResize
              @description Handle corners resize functionality
              @param {String} resizerName [Resizer name]
              @param {Object} e [Mouse event]
            */
            handleCornerResize: function (resizerName, e) {
                var el = this;
                var rightLimit = window.innerWidth - el._misc.windowPadding;
                var bottomLimit = window.innerHeight - el._misc.windowPadding;

                var newWidth, newHeight;

                switch (resizerName) {
                    case "topLeft":
                        newHeight = (el._misc.resize.startHeight + el._misc.resize.startY - e.clientY);
                        newWidth = (el._misc.resize.startWidth + el._misc.resize.startX - e.clientX);

                        if (e.clientY >= el._misc.windowPadding && e.clientX >= el._misc.windowPadding) {
                            newWidth = el._getAdjustedWidth(newWidth);
                            newHeight = el._getAdjustedHeight(newHeight);

                            if (newWidth != el.maxWidth && newWidth != el.minWidth) {
                                el._refs.dialog.style.left = e.clientX + "px";
                                el._refs.dialog.style.width = newWidth + "px";
                            }
                            if (newHeight != el.maxHeight && newHeight != el.minHeight) {
                                el._refs.dialog.style.top = e.clientY + "px";
                                el._refs.dialog.style.height = newHeight + "px";
                            }
                        }
                        break;

                    case "topRight":
                        newHeight = (el._misc.resize.startHeight + el._misc.resize.startY - e.clientY);
                        newWidth = (el._misc.resize.startWidth + e.clientX - el._misc.resize.startX);

                        if (e.clientY >= el._misc.windowPadding && e.clientX <= rightLimit) {
                            newWidth = el._getAdjustedWidth(newWidth);
                            newHeight = el._getAdjustedHeight(newHeight);

                            el._refs.dialog.style.width = newWidth + "px";

                            if (newHeight != el.maxHeight && newHeight != el.minHeight) {
                                el._refs.dialog.style.top = e.clientY + "px";
                                el._refs.dialog.style.height = newHeight + "px";
                            }
                        }
                        break;

                    case "bottomLeft":
                        newWidth = (el._misc.resize.startWidth + el._misc.resize.startX - e.clientX);
                        newHeight = (el._misc.resize.startHeight + e.clientY - el._misc.resize.startY);

                        if (e.clientX >= el._misc.windowPadding && e.clientY <= bottomLimit) {
                            newWidth = el._getAdjustedWidth(newWidth);
                            newHeight = el._getAdjustedHeight(newHeight);

                            if (newWidth != el.maxWidth && newWidth != el.minWidth) {
                                el._refs.dialog.style.left = e.clientX + "px";
                                el._refs.dialog.style.width = newWidth + "px";
                            }
                            el._refs.dialog.style.height = newHeight + "px";
                        }
                        break;

                    case "bottomRight":
                        newWidth = (el._misc.resize.startWidth + e.clientX - el._misc.resize.startX);
                        newHeight = (el._misc.resize.startHeight + e.clientY - el._misc.resize.startY);

                        if (e.clientX <= rightLimit && e.clientY <= bottomLimit) {
                            newWidth = el._getAdjustedWidth(newWidth);
                            newHeight = el._getAdjustedHeight(newHeight);
                            el._refs.dialog.style.width = newWidth + "px";
                            el._refs.dialog.style.height = newHeight + "px";
                        }
                        break;
                    default:

                }
            },

            /*
              @function (private) _getAdjustedWidth
              @description Checks that the width of the dialog does not exceed its limit size.
              @param {Number} width [Dialog width]
            */
            getAdjustedWidth: function (width) {
                var el = this;

                if (el.maxWidth != "auto") {
                    width = width <= el.maxWidth ? width : el.maxWidth;
                }

                if (el.minWidth != "auto") {
                    width = width >= el.minWidth ? width : el.minWidth;
                }

                return width;
            },

            /*
              @function (private) _getAdjustedHeight
              @description Checks that the height of the dialog does not exceed its limit size.
              @param {Number} height [Dialog height]
            */
            getAdjustedHeight: function (height) {
                var el = this;

                if (el.maxHeight != "auto") {
                    height = height <= el.maxHeight ? height : el.maxHeight;
                }

                if (el.minHeight != "auto") {
                    height = height >= el.minHeight ? height : el.minHeight;
                }

                return height;
            },

            /*
              @function (private) _addMaximize
              @description Adds maximize button and its functionality.
            */
            addMaximize: function () {
                var el = this;

                if (vcomet.util.isTrue(el.maximize) && el._refs.dialog.dataset.version == "desktop") {
                    el._refs.maximizeButton.classList.remove("vc-dialog-hidden");
                    el._refs.heading.classList.remove("vc-dialog-hidden");

                    el._refs.maximizeButton.addEventListener("click", function () {
                        if (el.dataset.status != "maximized") {
                            el._maximize();
                        } else {
                            el._restore();
                        }
                    });
                }

            },

            /*
              @function (private) _addMinimize
              @description Adds maximize button and its functionality.
            */
            addMinimize: function () {
                var el = this;

                if (vcomet.util.isTrue(el.minimize) && el._refs.dialog.dataset.version == "desktop") {
                    el._refs.minimizeButton.classList.remove("vc-dialog-hidden");
                    el._refs.heading.classList.remove("vc-dialog-hidden");

                    el._refs.minimizeButton.addEventListener("click", function () {
                        if (el.dataset.status != "minimized") {
                            el._minimize();
                        } else {
                            el._restore();
                        }
                    });
                }
            },

            /*
              @function (private) _maximize
              @description Maximize functionality
            */
            maximize: function () {
                var el = this;

                if (el.dataset.status != "minimized") {
                    el._savePreviousStatus();
                }

                document.body.appendChild(el._refs.dialog);

                el._refs.dialog.style.maxWidth = "none";
                el._refs.dialog.style.maxHeight = "none";
                el._refs.dialog.style.width = "100%";
                el._refs.dialog.style.height = "100%";
                el._refs.dialog.style.left = 0;
                el._refs.dialog.style.top = 0;

                el._refs.maximizeButton.classList.remove("vicon-maximize");
                el._refs.maximizeButton.classList.add("vicon-restore");

                el._refs.dialog.classList.remove("vc-dialog-minimized");
                el._refs.dialog.classList.remove("vc-dialog-scaled");

                el.dataset.status = "maximized";

                document.body.appendChild(el._refs.dialog);
            },

            /*
              @function (private) _minimize
              @description Maximize functionality
            */
            minimize: function () {
                var el = this;
                var minimizedBar = document.querySelector(".vc-dialog-minBar");

                if (!minimizedBar) {

                    minimizedBar = document.createElement("div");
                    minimizedBar.classList.add("vc-dialog-minBar");
                    document.body.appendChild(minimizedBar);
                }

                if (vcomet.util.isTrue(el.modal) && el._refs.overlay.parentNode) {
                    el._refs.overlay.parentNode.removeChild(el._refs.overlay);
                }

                if (el.dataset.status != "maximized") {
                    el._savePreviousStatus();
                }

                el._refs.dialog.style.left = "0";
                el._refs.dialog.style.top = "0";
                el._refs.dialog.style.minHeight = "auto";
                el._refs.dialog.style.height = "auto";
                el._refs.dialog.style.width = "auto";

                el._refs.dialog.classList.add("vc-dialog-minimized");
                el._refs.dialog.classList.remove("vc-dialog-scaled");

                el._refs.maximizeButton.classList.remove("vicon-restore");
                el._refs.maximizeButton.classList.add("vicon-maximize");

                minimizedBar.appendChild(el._refs.dialog);

                el.dataset.status = "minimized";

            },

            /*
              @function (private) _restore
              @description Returns a maximized or minimized dialog to its default position.
            */
            restore: function () {
                var el = this;

                if (el.dataset.status == "maximized") {
                    el._refs.maximizeButton.classList.remove("vicon-restore");
                    el._refs.maximizeButton.classList.add("vicon-maximize");
                } else if (el.dataset.status == "minimized") {
                    el._refs.dialog.classList.remove("vc-dialog-minimized");
                    document.body.appendChild(el._refs.dialog);
                }

                el._restorePreviousStatus();
            },

            /*
              @function (private) _savePreviousStatus
              @description Saves the dialog size and position before maximize or minimize it.
            */
            savePreviousStatus: function () {
                var el = this;

                el._misc.previousWidth = el._refs.dialog.offsetWidth;
                el._misc.previousHeight = el._refs.dialog.offsetHeight;
                el._misc.previousLeft = el._refs.dialog.offsetLeft;
                el._misc.previousTop = el._refs.dialog.offsetTop;

            },

            /*
              @function (private) _restorePreviousStatus
              @description Returns the dialog size and position after maximize or minimize it.
            */
            restorePreviousStatus: function () {
                var el = this;

                el._refs.dialog.style.minWidth = el.minWidth + "px";
                el._refs.dialog.style.minHeight = el.minHeight + "px";
                el._refs.dialog.style.maxWidth = el.maxWidth + "px";
                el._refs.dialog.style.maxHeight = el.maxHeight + "px";
                el._refs.dialog.style.width = el._misc.previousWidth + "px";
                el._refs.dialog.style.height = el._misc.previousHeight + "px";
                el._refs.dialog.style.left = el._misc.previousLeft + "px";
                el._refs.dialog.style.top = el._misc.previousTop + "px";

                el._handleWindowEdges();

                el.dataset.status = "";
            },

            /*
              @function (private) _verifyDeviceVersion
              @description Controls the different screens versions .
            */
            verifyDeviceVersion: function () {
                var el = this;
                el._refs.dialog.dataset.version = (vcomet.util.isTouchScreen()) ? "device" : "desktop";

                var mobileCondition = (window.innerWidth <= vcomet.mobileWidth || window.innerHeight <= vcomet.mobileWidth) && el._refs.dialog.dataset.version == "device";
                el._refs.dialog.dataset.mobile = mobileCondition ? "true" : "false";
            },

            /*
              @function (private) _assignSize
              @description Establishes the maximum and minimum sizes of dialog.
            */
            assignSize: function () {
                var el = this;

                if (el._refs.dialog.dataset.mobile == "false") {
                    el._refs.dialog.style.maxWidth = (el.maxWidth == "auto") ? el.maxWidth : el.maxWidth + "px";
                    el._refs.dialog.style.maxHeight = (el.maxHeight == "auto") ? el.maxHeight : el.maxHeight + "px";
                    el._refs.dialog.style.minWidth = el.minWidth + "px";
                    el._refs.dialog.style.minHeight = el.minHeight + "px";

                    if (el._misc.initialWidth && el._misc.initialHeight) {
                        el._refs.dialog.style.width = el._misc.initialWidth + "px";
                        el._refs.dialog.style.height = el._misc.initialHeight + "px";
                    }
                }

            },

            /*
              @function (private) _addOverlay
              @description Adds overlay if the dialog is modal type
            */
            addOverlay: function () {
                var el = this;

                if (vcomet.util.isTrue(el.modal)) {

                    if (!el._refs.overlay) {
                        el._refs.overlay = document.createElement("div");
                        el._refs.overlay.classList.add("vc-dialog-overlay", "vc-bg1-modal");
                    }

                    document.body.appendChild(el._refs.overlay);
                }
            },

            /*
              @function (private) _isFirstScaled
              @description Returns true if it is the first scaled dialog opened
            */
            isFirstScaled: function () {
                var openedScaledDialogs = document.querySelectorAll(".vc-dialog-scaled");
                return openedScaledDialogs.length == 0;
            },

            /*
              @function (private) _setPosition
              @description Sets the position of the dialogs depending on the value of multiposition properties.
            */
            setPosition: function () {
                var el = this;

                if (!vcomet.util.isTrue(el.modal) && el.multiposition == "scaled" && el._refs.dialog.dataset.version == "desktop" && !el._isFirstScaled()) {
                    el._scale();
                } else {
                    el._center();
                }
            },

            /*
              @function (private) _scale
              @description When there is more than one dialog open, position them scaled.
            */
            scale: function () {
                var el = this;

                // This will only scale the dialog if it is has not been scaled yet
                if (!el._refs.dialog.classList.contains("vc-dialog-scaled")) {
                    var openedScaledDialogs = document.querySelectorAll(".vc-dialog-scaled");
                    var lastOpenedScaled = openedScaledDialogs[openedScaledDialogs.length - 1];

                    lastOpenedScaled = lastOpenedScaled.isEqualNode(el._refs.dialog) ? openedScaledDialogs[openedScaledDialogs.length - 2] : lastOpenedScaled;

                    el._refs.dialog.style.left = lastOpenedScaled.offsetLeft + parseInt(el.scaleBreak) + "px";
                    el._refs.dialog.style.top = lastOpenedScaled.offsetTop + parseInt(el.scaleBreak) + "px";

                    el._misc.scaled.order = lastOpenedScaled.rootNode._misc.scaled.order ? lastOpenedScaled.rootNode._misc.scaled.order : 0;
                    el._misc.scaled.order = el._misc.scaled.order + 1;

                    el._refs.dialog.classList.add("vc-dialog-scaled");
                }

            },

            /*
              @function (private) _center
              @description Position the dialog in the center of the window.
            */
            center: function () {
                var el = this;
                el._refs.dialog.style.opacity = 0;

                if (el.multiposition == "scaled") {
                    el._refs.dialog.classList.add("vc-dialog-scaled");
                }

                setTimeout(function () {
                    el._assignCenterPosition();
                    el._refs.dialog.style.opacity = 1;
                    el._misc.centered = true;
                }, 0);
            },

            /*
              @function (private) _assignCenterPosition
              @description Calculations needed to centered the dialog
            */
            assignCenterPosition: function () {
                var el = this;
                var centerWidth = (window.innerWidth - el._refs.dialog.offsetWidth) / 2;
                var centerHeight = (window.innerHeight - el._refs.dialog.offsetHeight) / 2;
                el._refs.dialog.style.left = centerWidth + "px";
                el._refs.dialog.style.top = centerHeight + "px";
            },


            /*
              @function (private) _moveToFront
              @description Puts the dialog in the foreground by clicking on it.
            */
            moveToFront: function () {
                var el = this;

                // If the dialog was previously minimized or maximized,
                // when return to its default position, it will be placed in the foreground
                if (el.dataset.status != "minimized" && el.dataset.status != "maximized") {
                    var openedDialogs = document.querySelectorAll(".vc-dialog-visible:not(.vc-dialog-minimized)");
                    var minimizedBar = document.querySelector(".vc-dialog-minBar");
                    var fragment = document.createDocumentFragment();

                    for (var i = openedDialogs.length - 1; i >= 0; i--) {
                        if (!openedDialogs[i].isEqualNode(el._refs.dialog)) {
                            fragment.insertBefore(openedDialogs[i], fragment.childNodes[0]);
                        } else {
                            break;
                        }
                    }

                    document.body.insertBefore(fragment, el._refs.dialog);

                    if (minimizedBar) {
                        document.body.appendChild(minimizedBar);
                    }

                }

            },

            /*
              @function (private) _registerInitialSize
              @description Stores the initial size of the dialog.
            */
            registerInitialSize: function () {
                var el = this;

                if (!el._misc.initialWidth && !el._misc.initialHeight) {
                    el._misc.initialWidth = el._refs.dialog.offsetWidth >= (window.innerWidth - 20) ? "calc(100% - 20px)" : el._refs.dialog.offsetWidth;
                    el._misc.initialHeight = el._refs.dialog.offsetHeight >= (window.innerHeight - 20) ? "calc(100% - 20px)" : el._refs.dialog.offsetHeight;
                }

                // Prevents the scroll from exceeding the dialog since 
                // the dialog has no default size to limit the scroll on IE 
                if (vcomet.util.getBrowser() == "IE") {
                    el._refs.dialog.style.width = el._refs.dialog.offsetWidth >= (window.innerWidth - 20) ? "calc(100% - 20px)" : el._refs.dialog.offsetWidth + "px";
                    el._refs.dialog.style.height = el._refs.dialog.offsetHeight >= (window.innerHeight - 20) ? "calc(100% - 20px)" : el._refs.dialog.offsetHeight + "px";
                }
            },

            /*
              @function (private) _handleWindowResize
              @description Handles different options of the dialog when doing the resizing of the window.
            */
            handleWindowResize: function () {
                var el = this;

                // Stores the windows previous window resize size and the resize after do window resize
                el._misc.previousWindowWidth = el._misc.newWindowWidth;
                el._misc.newWindowWidth = window.innerWidth;

                // Only when the dialog is visible and is neither minimized nor maximized.
                if (el.dataset.status == "" && el._refs.dialog.classList.contains("vc-dialog-visible") && el._refs.dialog.dataset.mobile == "false") {

                    // When the dialog becomes visible sets its sizes
                    if (el._refs.dialog.style.width == "" && el._refs.dialog.classList.contains("vc-dialog-visible")) {
                        el._refs.dialog.style.width = el._refs.dialog.offsetWidth + "px";
                        el._refs.dialog.style.height = el._refs.dialog.offsetHeight + "px";
                    }

                    el._handleDialogSize();

                    // If the dialog is centered, when resizing the window, it will remain centered.
                    if ((el.multiposition == "centered" && el._misc.centered)) {
                        el._assignCenterPosition();

                        // If the dialog is scaled or has been moved, 
                        // it will stay right where it is only if it is not pushed by the window edges
                    } else {
                        el._handleWindowEdges();
                    }

                }

            },

            /*
              @function (private) _handleDialogSize
              @description Set dialog width when do the window resize
            */
            handleDialogSize: function () {
                var el = this;

                // When the dialog width is bigger than window set it a percentage width
                if (el._refs.dialog.offsetWidth >= (window.innerWidth - 20) && !el._misc.sizeControl) {
                    el._refs.dialog.style.width = "calc(100% - 20px)";
                    el._misc.sizeControl = true;
                }

                // When the window grows back, the width of the dialog is restored
                if (el.maxWidth != "auto") {
                    if (el._refs.dialog.offsetWidth < (window.innerWidth - 20) && el._refs.dialog.offsetWidth == el._misc.initialWidth && el._misc.sizeControl) {
                        el._refs.dialog.style.width = "";
                        el._misc.sizeControl = false;
                    }

                } else if (el._refs.dialog.offsetWidth <= (window.innerWidth - 20) && el._refs.dialog.offsetWidth >= el._misc.initialWidth && el._misc.sizeControl) {
                    el._refs.dialog.style.width = "";
                    el._misc.sizeControl = false;
                }
            },

            /*
              @function (private) _handleWindowEdges
              @description Handles window edges so that the dialog does not exceed it.
            */
            handleWindowEdges: function () {
                var el = this;

                var isOnRightEdge = (el._refs.dialog.offsetLeft + el._refs.dialog.offsetWidth) >= (window.innerWidth - el._misc.windowPadding);
                var isOnBottomEdge = (el._refs.dialog.offsetTop + el._refs.dialog.offsetHeight) >= (window.innerHeight - el._misc.windowPadding);
                var exceedsTopEdge = el._refs.dialog.offsetTop < el._misc.windowPadding;
                var exceedsLeftEdge = el._refs.dialog.offsetLeft < el._misc.windowPadding;

                if (isOnRightEdge || exceedsLeftEdge) {
                    el._refs.dialog.style.left = window.innerWidth - (el._refs.dialog.offsetWidth + el._misc.windowPadding) + "px";
                }

                if (isOnBottomEdge || exceedsTopEdge) {
                    el._refs.dialog.style.top = window.innerHeight - (el._refs.dialog.offsetHeight + el._misc.windowPadding) + "px";
                }
            },

            /*
              @function (private) _limitPosition
              @description Sets the limit of the window for cases in which, when opening several scaled dialogs, they do not exceed them
            */
            limitPosition: function () {
                var el = this;
                var exceedsWindowWidth = (parseInt(el._refs.dialog.style.left) + el._refs.dialog.offsetWidth) > (window.innerWidth - el._misc.windowPadding);
                var exceedsWindowHeight = (parseInt(el._refs.dialog.style.top) + el._refs.dialog.offsetHeight) > (window.innerHeight - el._misc.windowPadding);

                // If exceeds the window size, we will move the dialog to axis 0 so that we can know which would be its real size on that axis, then we set back its top/left to the position
                // its should be placed keeping in mind its width/height when it has space to grow
                if (exceedsWindowWidth || exceedsWindowHeight) {
                    var top = parseInt(el._refs.dialog.style.top);
                    var left = parseInt(el._refs.dialog.style.left);
                    var width, height;

                    el._refs.dialog.style.opacity = 0;

                    if (exceedsWindowHeight) {
                        el._refs.dialog.style.top = 0;
                    }

                    if (exceedsWindowWidth) {
                        el._refs.dialog.style.left = 0;
                    }

                    setTimeout(function () {
                        width = el._refs.dialog.offsetWidth;
                        height = el._refs.dialog.offsetHeight;

                        if (exceedsWindowWidth) {
                            el._refs.dialog.style.left = window.innerWidth - el._misc.windowPadding - width + "px";
                        }

                        if (exceedsWindowHeight) {
                            el._refs.dialog.style.top = window.innerHeight - el._misc.windowPadding - height + "px";
                        }

                        el._refs.dialog.style.opacity = 1;
                    }, 0);
                }
            }

        },

        functions: {
            /*
              @function open
              @description Open the dialog
            */
            open: function () {
                var el = this;
                if (!el._refs.dialog.classList.contains("vc-dialog-visible")) {
                    vcomet.triggerCallback("onOpen", el);
                    el._assignSize();
                    el._addOverlay();
                    el._setPosition();

                    el._refs.dialog.addEventListener("mousedown", function (e) {
                        if (e.button == 0 && el._refs.close.isOnPath == false) {
                            el._moveToFront();
                        }
                    });
                    el._refs.dialog.classList.add("vc-dialog-visible");

                    document.body.appendChild(el._refs.dialog);
                    el._handleDialogSize();
                    el._registerInitialSize();
                    el._limitPosition();

                    if (vcomet.util.isTrue(el.allowScroll)) {
                        el._refs.scroll.update();
                    }

                    vcomet.triggerCallback("onOpened", el);
                }

            },

            /*
              @function close
              @description Close the dialog
            */
            close: function () {
                var el = this;

                vcomet.triggerCallback("onClose", el);

                el.appendChild(el._refs.dialog);
                el._refs.dialog.classList.remove("vc-dialog-visible");
                el._refs.dialog.classList.remove("vc-dialog-scaled");

                if (el._refs.overlay && el._refs.overlay.parentNode) {
                    el._refs.overlay.parentNode.removeChild(el._refs.overlay);
                }

                if (el.dataset.status == "maximized") {
                    el._refs.maximizeButton.classList.remove("vicon-restore");
                    el._refs.maximizeButton.classList.add("vicon-maximize");
                }

                if (el.dataset.status == "minimized") {
                    el._refs.dialog.classList.remove("vc-dialog-minimized");
                }

                el.dataset.status = "";
                vcomet.triggerCallback("onClosed", el);
            },

        },

        onCreated: function () {
            var el = this;

            // Create callbacks
            vcomet.createCallback("onOpen", el);
            vcomet.createCallback("onOpened", el);
            vcomet.createCallback("onClose", el);
            vcomet.createCallback("onClosed", el);

            el._createRefs();

            el._misc.drag = {};
            el._misc.resize = {};
            el._misc.scaled = {};
            el._misc.windowPadding = 5;
            el._misc.sizeControl = false;
            el._misc.previousWindowWidth = window.innerWidth;
            el._misc.newWindowWidth = window.innerWidth;

            el._addContent();
            el._addFooter();

            el._refs.dialog.rootNode = el;
        },

        onInit: function () {
            var el = this;

            el._handleContentScroll();

            // ** Apply default items positioning style
            el._setDefaultStyle();

            el.dataset.status = "";
            el.multiposition = el.multiposition == "scaled" && vcomet.util.isTrue(el.modal) ? "centered" : el.multiposition;
            el.hasFooter = el._refs.userFooter ? true : el.hasFooter;

            el._verifyDeviceVersion();
        },

        onRender: function () {
            var el = this;

            el._addHeading();
            el._addBlurEvent();
            el._addDragListeners();
            el._addResizes();
            el._addMaximize();
            el._addMinimize();
        },

        onWindowResize: function (e) {

            this._verifyDeviceVersion();
            this._handleWindowResize(e);
        },

        onPropertyChanged: function (attrName, oldVal, newVal) {
            switch (attrName) {
                case "heading":
                    this._addHeading();
                    break;

                case "hasFooter":
                    this._handleFooterAppend();
                    break;
            }
        },
    });

</script>